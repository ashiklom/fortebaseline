---
title: |
  Structure and parameter uncertainty in centennial-scale projections
  of community-carbon cycling in a temperate forest
author:
  - Alexey N. Shiklomanov
  - Ben Bond-Lamberty
  - Jeff Atkins
  - Christopher M. Gough
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
    bookdown::html_document2:
      fig_caption: yes
    bookdown::pdf_document2:
      latex_engine: xelatex
    bookdown::word_document2:
      reference_docx: "../templates/taylor-francis-article.docx" # Insert path for the DOCX file
always_allow_html: true
bibliography: references.bib
csl: "../templates/ecology.csl"
abstract: |
  Forests in the US Upper Midwest have been a net C sink for a century, driven by their fast-growing, early successional species.
  However, the composition of these regrown forests has started to shift toward mid-successional species.
  Combined with changing climate and disturbance, this means that future biogeochemical and ecological dynamics in these forests are highly uncertain.
  Demographic vegetation models provide a tool for analyzing this uncertainty and its implications.
  Here, we evaluate the relative importance of model "structural" (which processes are represented, and how) and "parameter" (parameters used in those equations) uncertainty, asking:
  (1) Which processes are most important to accurately model community succession and C cycling in Upper Midwest forests?
  (2) What are the relative contributions of parameter vs. structural uncertainty?
  We ran ensembles of the Ecosystem Demography model v2.2 (sampling over parameter uncertainty) at the University of Michigan Biological Station (UMBS) from 1900 to 2000 with different representations of key processes important to competition for light.
  We then compared the magnitude of structural (across representations) and parameter (within each representation) uncertainty, and assessed which submodel-parameter combinations reproduced observed C fluxes and succession.
  On average, our simulations underestimated both net primary productivity (NPP) and leaf area index (LAI) after 100 simulation years, though NPP estimates at peak productivity (20-50 years into the simulations) were closer to observations.
  However, parameter uncertainty was large; at any given timestep, both NPP and LAI ranged from ~0 to >200% of their mean value.
  Although many simulations matched either the observed NPP or observed LAI at some point during the simulation, only a small minority of individual runs matched both.
  The few runs that matched observed NPP and LAI also matched the present-day composition (early hardwood-dominated).
  Structural uncertainty was less important than parameter uncertainty, but model configuration did influence the ecological dynamics within a given parameter set, and affected which parameters were most influential.
  We conclude that: (1) targeted data collection to constrain vegetation model parameters should be a higher priority than model development; (2) parameter sensitivity analyses are not necessarily generalizable across model structures; and (3) robust model validation requires scrutiny of multiple different variables, including those related to vegetation productivity and composition.
keywords: |
  Dynamic vegetation modeling; carbon cycle; forest succession
highlights: |
  TODO
---

```{r setup, include = FALSE}
library(knitr)
library(here)
library(magrittr)
library(kableExtra)

fig <- function(...) {
  knitr::include_graphics(here::here("analysis", "figures", ...))
}

opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  out.width = "\\linewidth"
  ## fig.path = "../figures/"
)

## library(fortebaseline) # Or use devtools::load_all('.', quiet = T) if your code is in script files, rather than as functions in the `/R` diretory
n <- 0
mdcap <- function(text) {
  n <<- n + 1
  out <- sprintf("**Figure %d**: %s", n, text)
  if (grepl("gfm", knitr::opts_knit$get("rmarkdown.pandoc.to"), ignore.case = TRUE)) {
    out
  } else {
    invisible(NULL)
  }
}
m <- 0
htmlfig <- function() {
  m <<- m + 1
  out <- paste0("**Figure ", m, "**:")
  if (knitr::is_html_output()) {
    out
  } else {
    invisible(NULL)
  }
}
```

# Introduction

**Forests are a defining feature of the US North**.
This region is the most heavily forested region in the US, and these forests are an essential provider of employment and recreation opportunities and other ecosystem services for the region's people, and of habitat for the region's wildlife [@shividenko_2005_forest; @shifley_2012_forests].
In addition, the **forests of the Upper Midwest** in particular have been a **net carbon sink** for most of the past century, as fast-growing early successional species established and thrived following near-complete deforestation around the end of the 19th Century [@birdsey_2006_forest; @williams_2012_carbon].
However, the **fate of these forests is highly uncertain**.
Many Upper Midwest forests are undergoing a **shift in community composition from early-successional to mid-successional** species, and the ecological and biogeochemical consequences of this transition are not well-established [@gough_2016_disturbance].
In addition, these forests face a multitude of **direct and indirect pressures from both biotic and abiotic sources** [@shifley_2016_future], including longer and more severe droughts [@gustafson_2016_implications; @swanston_2017_vulnerability; @lienard_2016_us], non-native insects and pathogens [@lovett_2016_nonnative], and more. <!-- TODO More here? -->
Collectively, these processes have culminated in forests that are different from their pre-settlement climax counterparts [@stearns_2002_one; @wolter_2002_recent; @thompson_2013_four], and **our ability to make predictions about such non-analog environments based on the past is limited**.

**More reliable predictions can in theory be obtained by using dynamic vegetation models that explicitly represent processes involved in forest growth and mortality.**
Vegetation models fall along a spectrum of complexity, which is a direct consequence of trade-offs between **realism and process fidelity** on one hand and **tractability, computational demand, and data requirements** on the other [@hawkes_2000_woody]. <!-- TODO Might need a better ref here -->
On one side are relatively simple **"big leaf" models**---such as PNET, SiBCASA, and Biome-BGC---in which the vegetation at a particular location consists essentially of a single large "plant" whose characteristics are the weighted average of all the vegetation at that site <!-- TODO REFS -->
On the other are **"individual-based" or "gap" models**---such as LANDIS [@mladenoff_2004_landis; @scheller_2007_design] and UVAFME [@shuman_2015_forest]---which explicitly simulate individuals competing for resources at a single site [@shugart_2015_computer].
Because these models explicitly represent interspecific differences in plant productivity, resource allocation, and stress tolerance (among others), as well as the competition that emerges out of these differences, they may be better able to represent changes in ecosystem-scale processes, especially in no-analog conditions [@purves_2008_predictive].
Between these two extremes are models that use approximations to attempt to capture the emergent biogeochemical and ecological outcomes of interactions between individuals without explicitly simulating each individual [@purves_2008_predictive].
One example of this approach is the **Ecosystem Demography model** [ED2; @moorcroft_2001_method; @medvigy_2011_predicting; @longo_2019_ed1], which is the focus of this study.
<!-- BBL: Perhaps mention ED2's influence in ESMs and LSMs -->

**Regardless of vegetation model complexity, their projections are inherently uncertain.**
This uncertainty comes from many different sources, which can broadly be classified as follows:
_Driver_ uncertainty is uncertainty in data about processes not represented by the model (e.g. weather and climate for vegetation models).
_Initial condition_ uncertainty arises from the fact that the exact conditions at the place and time simulations begin are frequently unknown.
_Process_ or _structural_ uncertainty arises because models necessarily represent only a subset of all processes involved in plant biology, and that those processes that are included can usually be represented in multiple different ways (i.e. which processes are included, and how they are represented).
Finally, _parameter_ uncertainty arises because of natural variability and imperfect calibration of the above process representations.
**The relative importance of these sources of uncertainty in ecological forecasts is important as a driver of future research priorities**.

**Many ecosystem modeling studies have looked at these categories of uncertainty independently.**
<!-- TODO Consider cutting 50-75% of these next few sentences. Probably way too much detail. -->
@dietze_2014_quantitative investigated which parameters were most important to ED2 predictions of C sequestration across a diverse range of sites in North America.
They found that the parameters contributing the most to overall predictive uncertainty were those related to growth respiration, mortality, stomatal conductance, and water uptake, and that parameter uncertainty varied with biome.
More recently, @raczka_2018_what evaluated parameter uncertainty over 100 year time scale at the Willow Creek Ameriflux site, and found that the most important parameters to model uncertainty were quantum efficiency of photosynthesis, leaf respiration, and soil-plant water transfer.
Another study looked specifically at contributions to uncertainty from parameters related to canopy radiative transfer, and found that parameters related to both canopy structure and leaf optical properties had a large impact on predictions of net primary productivity [@viskari_2019_influence].
{**Driver uncertainty** -- a few examples?}

**Other studies have investigated structural uncertainty.**.
Numerous vegetation model intercomparison studies have demonstrated that different models produce significantly different projections of overall land carbon sequestration [@friedlingstein_2006_climate; @friedlingstein_2014_uncertainties], response to CO~2~ fertilization [@zaehle_2014_evaluation; @medlyn_2015_using; @walker_2015_predicting], and soil C sequestration [@sulman_2018_multiple], among others.
In particular, @lovenduski_2017_reducing found that model structural uncertainty was the primary source of uncertainty in Earth system model projections of the land C sink.
This structural uncertainty has been attributed to differences in model representations of key processes, including canopy radiative transfer [@fisher_2017_vegetation], soil biogeochemistry [@wieder_2017_carbon; @sulman_2018_multiple], stomatal conductance [@franks_2018_comparing], and photosynthesis [@rogers_2016_roadmap].
**However, the extent to which specific processes contribute to model uncertainty is difficult to evaluate from model intercomparisons because different models are different from each other in too many different ways, meaning that structural effects are confounded with other uncertainty sources.**
**Moreover, comparative analysis of contributions of different types of uncertainty to model projections are rare in the ecosystem modeling literature**.
<!--
TODO Do we have any examples? Or are these studies entirely non-existent?

Ben's notes:which of the last two categories--structural versus parameter uncertainty--is more important (Fisher et al. 2015, https://onlinelibrary.wiley.com/doi/full/10.1111/j.1523-1739.2003.00614.x, Ricciuto et al. 2008).
-->

<!-- TODO This paragraph is janky as hell. Needs heavy revision. -->
{Chris/Jeff: Help!}
Previous work found that an earlier version of ED had difficulty sustaining multiple plant functional types in long simulations [@fisher_2010_assessing].
One of the primary drivers of successional change in temperate forests is competition for light (REF Bazzaz 19XX) <!-- TODO REF -- Bazaaz? -->, and differences in plants' strategies for light acquisition and utilization are a key driver of niche differentiation in these ecosystems <!-- TODO REF -->.
Plants compete for light in three different ways:
Growing quickly (early successional, pioneer species),
structural complexity / morphological change / filling in gaps in existing canopies,
and adapting traits to maximize light (and other resource) capture and utilization.
To this end, we focused our structural uncertainty analysis on three processes related to competition for light:
Representation of horizontal competition;
representation of canopy radiative transfer (especially of diffuse radiation);
and trait plasticity with light level.

**This study focuses on the interaction between parameter and structural uncertainty.**
Our study is organized around the following guiding questions:
(1) Which processes related to light utilization are most important to accurately model community succession and C cycling in Upper Midwest forests?
(2) What are the relative contributions of parameter uncertainty (data limitation) vs. structural uncertainty (theoretical limitation)?
We ran ensemble simulations of the Ecosystem Demography (ED-2.2) model with a factorial combination of submodels related to radiative transfer formulation, horizontal competition, and trait plasticity.
We then used sensitivity and variance decomposition analyses to evaluate the contribution of parameter uncertainty for each model configuration, exploring the ecological implications of the results in the context of ongoing climate change.

# Methods

## Site description

We performed this study at the University of Michigan Biological Station (UMBS; Ameriflux site US-UMd, 45.5625$^{\circ}$, -84.6975$^{\circ}$), located in Northern Lower Michigan, USA.
The area surrounding the research station is 87% well-drained upland forest and 13% wetland [@bergen_2007_observing]; the focus of this study is on the former.
The landscape geography of the UMBS upland forest is 20.4% moraine, 37.8% high outwash plain, 31.3% low outwash plain, 5.7% lake-margin terrace, 3.6% ice-contact, and 1.2% lowland glacial lake [@bergen_2007_observing].
Most of the UMBS upland forest canopy is dominated by temperate deciduous early-successional species, most importantly _Populus grandidentata_ (bigtooth aspen) and, to a lesser extent, _Betula papyrifera_ (paper birch), with _Acer saccharum_ (sugar maple), _Acer rubrum_ (red maple), _Fagus grandifolia_ (American beech), _Tilia americana_ (basswood), _Betula alleghaniensis_ (yellow birch), _Fraxinus americana_ (white ash), _Tsuga canadensis_ (eastern hemlock), _Quercus rubra_ (northern red oak), _Pinus strobus_ (white pine), and _Pinus resinosa_ (red pine) existing in various fractions in the understory (and, in patches, in the canopy).
This composition is a legacy of the site's disturbance history:
The site was intensively logged and burned in the late 1800s and early 1900s, and experienced regularly recurring fires until the mid-1920s, at which point a regime of active fire suppression started that has persisted to the present day [@kilburn_1960_effects; @barnes_1981_michigan; @friedman_2005_regional_legacies_logging].
As a result, the average stand age in 2013 was 95 years [@gough_2013_sustained].
The majority of the forest that is aspen-dominated is undergoing succession to "northern hardwood" (maple, beech, basswood, birch, ash, hemlock), "upland conifer" (red and white pine), or "northern red-oak" ecotypes [@bergen_2007_observing].


## Ecosystem Demography Model (version 2.2)

For this study, we used the Ecosystem Demography Model, version 2.2 (ED-2.2) to simulate forest C cycling and plant functional type (PFT) composition.
A full description of the default configuration of the model is provided by @longo_2019_ed1.
Briefly, ED-2.2 solves the energy, water, and carbon cycles separately for each of multiple "cohorts" of trees of similar composition, size, and age sharing a micro-environment and disturbance history [@moorcroft_2001_method; @medvigy_2009_mechanistic; @longo_2019_ed1].
Besides the cohort-based approximation of gap dynamics, a distinctive feature of ED-2.2 is that the equations for energy, water, and carbon fluxes are defined in terms of total energy, water, and carbon, which ensures excellent conservation of mass in long-running (multidecadal) simulations [@longo_2019_ed1].
Various versions of the ED model have been evaluated in boreal [@medvigy_2011_predicting], temperate [@medvigy_2009_mechanistic; @dietze_2014_quantitative; @raczka_2018_what], and tropical biomes [@moorcroft_2001_method; @longo_2019_ed2], and have been applied in, among others,
paleoecological studies [@rollinson_2017_emergent],
free-air CO~2~ enrichment studies [@dekauwe_2013_forest; @miller_2015_alteration],
estimation of potential carbon stocks [@hurtt_2004_beyond_potential_vegetation],
and analyses of regional vegetation-climate feedbacks [@swann_2015_future].

The official ED2 source code is available at https://github.com/EDmodel/ED2, and the exact version used in this study (which includes minor revisions to accommodate the requirements of this study) can be obtained at https://github.com/ashiklom/ED2/tree/b048950971e91699b78fc566df133caf977fda32.

## Submodels

In this study, we ran a factorial combination of the following ED-2.2 configurations: (1) two-stream vs. multiple-scatter canopy radiative transfer models (RTMs); (2) closed canopy vs. finite crown area (a.k.a. complete vs. partial shading); and (3) static vs. light-plastic traits.

Both canopy RTMs in ED-2.2 resolve the full vertical radiation profile within a patch as a function of canopy structure (leaf and wood area indices, crown area, leaf angle distribution) and incident solar radiation, following the definitions in CLM 4.5 [@clm45_note].
Both models also use identical definitions for the optical properties of a single canopy layer as a function of leaf and wood optical properties, leaf angle distribution, canopy clumping, solar zenith angle, and leaf, wood, and crown area indices.
Both models represent direct (a.k.a. "beam") radiation as an exponentially decaying process, and solve for the diffuse (a.k.a. "hemispherical", "isotropic") radiation at each layer using a linear matrix equation.
Where the models differ is in the terms of this matrix equation.
The two-stream model (default) uses the two-stream approximation originally derived for atmospheric radiative transfer [@meador_1980_two] and later adapted to vegetation canopies [@dickinson_1983_land; @sellers_1985_canopy].
Meanwhile, the multiple-scatter model was derived from first principles by @zhao_2005_multiple specifically for vegetation canopies to address known biases and limitations of the two-stream approach [e.g. @wang_2003_comparison].
**Compared to the default two-stream model, the multiple-scatter model slightly increases diffuse light levels in the understory.**
Both of these models are described in detail in the Supplementary Information. <!-- TODO Exact reference to Appendix -->

The crown area submodel in ED-2.2 determines the nature of competition for light between cohorts.
In the default configuration ("closed canopy"), the leaf area of a cohort is distributed across the entire horizontal area of a patch.
This means that taller cohorts always receive more incoming radiation than shorter cohorts, even when the height difference is small.
Similar approaches have been shown to excessively suppress competition from sub-dominant individuals and result in unrealistically homogeneous forest patches [@fisher_2015_taking].
In the alternate configuration ("finite crown area"), canopies take up only a fraction of the available horizontal area, which generally exposes the understory to more light.
The horizontal area of crowns is determined by allometric equations from @dietze_2008_changing.

The third submodel we evaluated was trait plasticity.
In the default configuration, all cohorts of a given plant functional type have the same parameters, regardless of environmental conditions.
This ignores the globally-documented intraspecific trait variability as a function of light level [@niinemets_2010_review; @keenan_2016_global]. <!-- TODO Also, classical ecological succession theory bazzaz_1979_physiological? -->
In the alternate configuration, as light level decreases (trees become more shaded), specific leaf area increases and V~cmax~ decreases, following empirical relationships from the tropics [@lloyd_2010_optimisation].

These sub-models are summarized in Table \@ref(tab:submodels).

Table: (\#tab:submodels) ED-2.2 submodel descriptions

| Name | Description | Color |
|------|-------------|-------|
| **Crown model** |||
| **C**losed (default) | Cohort crowns take up entire patch area. Competition for light based only on height. | Light |
| **F**inite | Cohort crown area is proportional to DBH according to PFT-specific allometry. | Dark |
| **Radiative transfer model (RTM)** |||
| **T**wo-stream (default) | Two-stream approximation [@sellers_1985_canopy; @clm45_note] | Primary (red, blue) |
| **M**ulti-scatter | Multiple-scatter approximation, following [@zhao_2005_multiple] | Secondary (green, orange) |
| **Trait plasticity** |||
| **S**tatic (default) | SLA and V~c,max~ are constant | Cool (blue, green) |
| **P**lastic | SLA increases, and V~c,max~ decreases, with light level | Warm (red, orange) |


## Parameter descriptions

```{r param-table}
tbl <- readr::read_csv(here(
  "analysis", "data", "derived-data", "parameter-table.csv"
))
tbl <- subset(tbl, Ran == "yes", select = c(-unit_parsed, -Ran))
tbl[["ED Name"]] <- sprintf("`%s`", tbl[["ED Name"]])
cap <- paste(
  "Parameter descriptions.",
  "For additional information, see the",
  "[ED2 model wiki](https://github.com/EDmodel/ED2/wiki/PFT-parameters)."
)
if (is_latex_output() || is_html_output()) {
  kable(tbl, escape = is_latex_output(), caption = cap, booktabs = TRUE) %>%
    kable_styling(latex_options = "scale_down")
} else {
  # Probably DOCX output
  cap <- paste("Table: (\\#tab:param-table)", cap)
  flextable::flextable(tbl) %>%
    flextable::autofit() %>%
    flextable::fit_to_width(7.5) %>%
    flextable::set_caption(cap)
}
```

The full list of parameters in ED-2.2 is large, with over 100 parameters per plant functional type.
A full sensitivity and uncertainty analysis across all of these parameters is outside the scope of this study.
Instead, we selected a subset of parameters (Table \@ref(tab:param-table)) guided by (but expanding upon) previous ED-2.2 sensitivity studies [@dietze_2014_quantitative; @raczka_2018_what; @viskari_2019_influence].

Three parameters are related to leaf-level physiology:
Following the enzyme-kinetic model of @farquhar_1980_biochemical, the rate of photosynthesis is the minimum of light-limited and enzyme-limited reactions.
The former are controlled by the _quantum efficiency_ parameter---maximum efficiency with which absorbed photosynthetically active radiation is converted to CO~2~.
The latter are controlled by _V~cmax~_, the maximum rate of carbon fixation by Rubisco.
The water demand of photosynthesis is controlled by the _stomatal slope_, the sensitivity of stomatal conductance of CO~2~ as a function of CO~2~ concentration and humidity at the leaf surface [@leuning_1995_critical; @ball_1987_model].
Three more parameters correspond to the respiration rates of _leaves_, _roots_, and "_growth maintenance_".

Two more parameters control carbon allocation:
One is the ratio of fine root to leaf biomass (`fineroot2leaf`, or `q`), and another is the ratio of "storage" carbon allocated to reproduction (`r_fract`).

Three parameters control various aspects of adult tree mortality.
The overall adult mortality rate in ED-2.2 ($M$) is the sum of density-independent mortality from aging ($M_I$, plants year^-1^), density-dependent mortality from C starvation ($M_D$), and mortality from cold/frost ($M_F$) (ED-2.2 technically also includes additional term for fire mortality, but we did not include fire in our simulations):

$$
M = M_I + M_D + M_F
$$

Density-independent mortality from aging ($M_I$) is a prescribed, PFT-specific parameter (`mort3`).
Density-dependent mortality from C starvation is calculated as a function of a cohort's C balance limitation:

$$
M_D = \frac{y_1}{1 + \exp\left[y_2 \left( \frac{C_k}{C_k^*} \right)\right]}
$$

where $C_k$ is the 12 month running mean C balance of the cohort, $C_k^*$ is the running mean ideal C balance if there was no light or water limitation, and $y_1$ (`mort1`; plants year^-1^) and $y_2$ (`mort2`; unitless) are PFT-specific parameters.
_Seedling mortality_ rate is prescribed as its own PFT-specific parameter.

Several parameters are related to canopy structure and radiative transfer.
_Specific leaf area_ (`SLA`) is used to convert leaf biomass to leaf area index, which in turn is used in a variety of calculations related to canopy radiative transfer and micrometeorology.
Canopy _clumping factor_ describes how evenly leaf area is distributed in horizontal space (1 being perfectly evenly; 0 being a "black hole" where all leaves are concentrated in a single point); and
leaf _orientation factor_ describes the average distribution of leaf angles (-1 being perfectly vertical, 1 being perfectly horizontal, and 0 being random).
Four parameters control leaf optical properties, namely the fractions of light reflected or transmitted in visible and near-infrared wavelengths (`leaf_(reflect|trans)_(vis|nir)`).
Details of how these parameters influence canopy radiative transfer are described in the Supplementary Information.

Other parameters (TODO, briefly):

- Fraction of litter carbon that enters the labile (fast) soil carbon pool (`f_labile`)
- Minimum plant height for reproduction (`repro_min_h`)
- Soil-plant water conductance, or "water availability factor" (`water_conductance`)
- C:N ratio in fine roots (`c2n_fineroot`) and leaves (`c2n_leaf`)
- Leaf turnover rate (evergreen-only; `leaf_turnover_rate`)
- Proportion of dispersal that is "global" (`nonlocal_dispersal`) <!-- TODO What is this? Can I drop it from the analysis? -->

## Plant functional types and parameterization

By default, ED-2.2 supports 17 different plant functional types, which divide plant species according to photosynthetic pathway (C3 vs. C4), growth form (grass vs. tree), leaf phenology habit (deciduous vs. evergreen), biome (e.g. temperate vs. tropical), and successional status (e.g. early, mid, late).
However, we limited our simulations to the four plant functional types that have any appreciable presence at UMBS: Early, mid, and late temperate deciduous trees and pines.
The species comprising these plant functional types are shown in Table 3.

Table: (\#tab:pft-species) Plant functional type-species mappings

| Plant functional type | Species                 | Color  |
|-----------------------|-------------------------|--------|
| Early hardwood        | _Betula papyrifera_     | Violet |
|                       | _Populus grandidentata_ |        |
|                       | _Populus tremuloides_   |        |
| Mid hardwood          | _Quercus rubra_         | Blue   |
|                       | _Acer rubrum_           |        |
|                       | _Acer pensylvaticum_    |        |
| Late hardwood         | _Acer saccharum_        | Green  |
|                       | _Fagus grandifolia_     |        |
| Pine                  | _Pinus strobus_         | Yellow |

For each plant functional type, we generated a distribution of parameter values via the Predictive Ecosystem Analyzer (PEcAn) trait-meta analysis [@lebauer_2013_facilitating; see also @dietze_2014_quantitative; @raczka_2018_what].
Prior distributions for this meta-analysis were largely adapted from previous ED2 parameter uncertainty studies [@dietze_2014_quantitative; @raczka_2018_what; @viskari_2019_influence], and are shown in detail in Supplementary Information X. <!-- TODO Priors supplement; maybe describe entire meta-analysis? -->
Species trait data for this meta-analysis came from existing records in the BETY database [www.betydb.org, @lebauer_2017_betydb], as well as from publicly available records in the TRY database [www.try-db.org, @kattge_2011_try] and, specifically for leaf optical properties, from Shiklomanov (2019 {dissertation, chapter 3}).
All parameters not described in this section were set to their ED-2.2 PFT-specific default values for all simulations.

## Modeling workflow

For each factorial combination of model configurations (described above), we ran ED-2.2 once with its default parameter values, once at the posterior median estimates from the meta-analysis, and 500 times with parameters sampled randomly from the meta-analysis posterior distributions.
For the latter, the same 500 parameter samples were used for all model structures to allow us to independently evaluate the impacts of model structure at specific parameter values.
Each ensemble member ran from January 1, 1902 through December 31, 1999 and was initialized from a "near-bare ground" condition: An equal number of seedlings of each plant functional type (see previous section) at the minimum resolvable size.
Driving meteorological data was 6-hourly CRU-NCEP (REF) combined with an annual atmospheric CO~2~ record from Law-Dome ice core [@etheridge_1998_historical] and Mauna Loa observatory [@thoning_1989_atmospheric] linearly interpolated to 3-hourly resolution.
Soil texture was set to 92% sand, 7% silt, and 1% clay, based on site-level observations [@gough_2010_wood].
The initial soil moisture profile was set to the average soil moisture profile reported in the UMBS Ameriflux ancillary data (https://ameriflux.lbl.gov/sites/siteinfo/US-UMd).
By using the same initial conditions and drivers, we do not consider initial condition and driver uncertainty, which are outside the scope of this study.

## Analysis of results

First, we evaluated the impact of model structure independent of any changes to parameters by comparing predictions of average annual net primary productivity (NPP) and summer (June, July, August) total leaf area index (LAI) across model structures while holding ED-2.2 parameters at their default values (Figure \@ref(fig:structure-compare-default)).
To understand the physical and ecological mechanisms underlying these differences, we also compared the cohort-level composition, height, and canopy radiation profiles in these simulations in four stages of the simulation (Figure \@ref(fig:structure-compare-light)).

Second, we compared simulations with ED-2.2 default parameters against simulations using median parameter estimates from a trait meta-analysis (Figure \@ref(fig:param-dist)).
Here, we looked predictions of annual mean C fluxes (gross and net primary productivity, and autotrophic and heterotrophic respiration; Figure \@ref(fig:default-median-flux)) and of summer LAI by PFT (Figure \@ref(fig:default-median-lai)).

Third, we considered the full range of parameter uncertainty by looking at predictions across all parameter ensemble members.
We begin with predictions annual mean NPP and summer mean total LAI across all parameters and structures and compare these results to contemporary (averaged over years TODO) observations of NPP and LAI at UMBS.
We look at these variables independently as time series (Figure \@ref(fig:summary-ts-plot)) and as joint predictions in two periods (Figure \@ref(fig:pairs-time)).
We then consider impacts on composition by looking at predicted PFT fractions of total aboveground biomass (AGB) at four different years in the simulation (Figure \@ref(fig:pft-jitterplot)) and at time series of LAI by PFT for five parameter combinations spanning the range of predicted ecological outcomes (Figure \@ref(fig:lai-pft-plot)).

Finally, we assessed which parameters contributed the most to parameter uncertainty for each model structure.
We did this by performing a sensitivity and variance decomposition analysis following @lebauer_2013_facilitating, @dietze_2014_quantitative, and @raczka_2018_what (Figure \@ref(fig:partial-variance-npp)).
Briefly, this analysis contains uses a spline to estimate the relationship between individual parameters and output variables and then uses these splines to predict the variance in the output variable attributable to individual parameters ("partial variance").
For more details, see @lebauer_2013_facilitating.

All analyses for this work were performed using R 3.6 (see "Colophon" for full details).
Code and supporting data for reproducing this analysis are publicly available on the Open Science Framework (OSF) at https://osf.io/dznuf/.

# Results

## Impacts of structure alone

```{r structure-compare-default, fig.cap = structure_default_cap}
### Figure 1
structure_default_cap <- paste(
  htmlfig(),
  "Annual NPP and LAI from ED2 runs",
  "with default parameters",
  "across different configurations."
)
fig("structure-compare-default.png")
```

Different model structures agreed for the first half of the simulation, at which point they started to diverge (Figure \@ref(fig:structure-compare-default)).
Post 1950, the combination of two-stream RTM, finite canopy radius, and plastic traits had the highest productivity, followed by the same configuration with static traits, with the remaining configurations having very similar results.
Interestingly, the effects of changing individual model configurations were not additive --- for example, enabling trait plasticity had a much stronger positive effect when paired with the two-stream canopy RTM than with the multiple-scatter canopy RTM.

```{r structure-compare-light, fig.cap = structure_default_light_cap}
### Figure 2
structure_default_light_cap <- paste(
  htmlfig(),
  "Radiation profiles of cohorts from ED2 runs with",
  "default parameters, across different configurations.",
  "Each point represents a single cohort of the given PFT,",
  "position on the y-axis represents the height of that cohort,",
  "and position on the x-axis represents the relative light level",
  "received by that cohort."
)
fig("default-light-levels.png")
```

Differences in productivity across model structures were related to differences in composition and vertical canopy radiation profiles over the course of the simulation (Figure \@ref(fig:structure-compare-light)).
Enabling the finite canopy radius increased the availability of light for understory cohorts throughout the simulation, particularly in the first half of the simulation.
Again, however, the effects of model structures were not strictly additive:
Switching from a two-stream to a multiple-scatter canopy RTM enhanced the understory light environment (albeit slightly) under a closed canopy, but the brightest understory occurred under the combination of the two-stream RTM and finite canopy.
Despite these differences, by 1980 none of the configurations was able to sustain any PFTs other than early hardwoods, and only configurations with finite canopy and two-stream RTM were able to sustain more than a single dominant cohort (two early hardwood cohorts with static traits, and three with plastic traits).

## Default vs. median parameters

```{r param-dist, fig.cap = param_dist_cap}
### Figure 3
param_dist_cap <- paste(
  htmlfig(),
  "Input parameter distributions from PEcAn trait meta-analysis."
)
fig("param-dist.png")
```

Parameter estimates from the trait meta-analysis were often substantially different from the ED-2.2 defaults (Figure \@ref(fig:param-dist)).
In many cases, median parameter estimates were different entirely because of the choice of prior distributions.
However, in several important cases, parameters well-constrained by data produced values substantially different from the ED2 defaults.
For example, ED-2.2 default values for V~cmax~ were too low for all PFTs, and default values for SLA were too low for all PFTs except Early Hardwoods.

```{r default-median-flux, fig.cap = default_median_flux_cap}
### Figure 4
default_median_flux_cap <- paste(
  htmlfig(),
  "Comparing results of ED2 with default parameters and",
  "posterior median parameters from trait meta-analysis",
  "across different strucures."
)
fig("default-median-fluxes.png")
```

These differences in parameter values resulted in ED-2.2 runs that differed from the default runs in several important ways (Figures \@ref(fig:default-median-flux), \@ref(fig:default-median-lai)).
First, in every model configuration (except finite canopy, two-stream RTM, and static traits), gross primary productivity (GPP) reached a higher peak, and did so earlier under median parameters (Figure \@ref(fig:default-median-flux)).
This was driven primarily by higher V~cmax~ and SLA values for most PFTs (Figure \@ref(fig:param-dist)).
However, this increase in GPP was offset by a large increase in autotrophic respiration (RA; Figure \@ref(fig:default-median-flux)), driven primarily by higher growth and leaf respiration rates across all PFTs (notably, the ED-2.2 default is _zero growth respiration_ for all temperate hardwood PFTs; Figure \@ref(fig:param-dist)).
The resulting net primary productivity (NPP) had similar peak values under default and median parameters, though the temporal patterns were quite different in most model configurations (Figure \@ref(fig:default-median-flux)).

Second, the variation across model structures was much higher, with every change in model structure exerting a noticeable effect on flux variability (Figure \@ref(fig:default-median-flux)).
The most dramatic example is that, with median parameter values, simulations with the finite canopy radius produced much lower net productivity and heterotrophic respiration than simulations with a closed canopy in the second half of the simulation.
Yet again, interactions between configurations were significant.
For example, under a closed canopy configuration, enabling trait plasticity caused interannual variability in NPP to decrease with a two-stream RTM and increase with a multiple-scatter RTM.

```{r default-median-lai, fig.cap = default_median_lai_cap}
### Figure 5
default_median_lai_cap <- paste(
  htmlfig(),
  "Comparing results of ED2 PFT-level LAI",
  "with default parameters",
  "posterior median parameters from trait meta-analysis",
  "across different strucures."
)
fig("default-median-lai.png")
```

Third, even where NPP was similar between default and median runs, the underlying forest composition was very different (Figure \@ref(fig:default-median-lai)).
With the default parameterization, ED-2.2 produces forests dominated by Early Hardwoods, with an understory of small mid- and even smaller late-hardwood trees that eventually die out.
However, with the median parameterization, ED-2.2 starts out with forests dominated by _mid_-hardwood species that are quickly (pre-1910 to 1930, depending on configuration) replaced with pine, which remains the dominant canopy species throughout the rest of the simulation.
Exploratory analyses (results not shown) show that the main parameters responsible for this compositional trajectory are SLA (especially the higher SLA of pine and mid-hardwood), V~cmax~, and growth respiration.
While the uncertainty in growth respiration is large, we emphasize that SLA and V~cmax~ are well constrained by data for all PFTs considered in this analysis.

## Structure vs. parameter uncertainty

```{r summary-ts-plot, fig.cap = summary_ts_cap}
### Figure 6
summary_ts_cap <- paste(
  htmlfig(),
  "ED2 plot-level predictions of",
  "net (NPP) primary productivity and",
  "total leaf area index (LAI),",
  "by model configuration.",
  "The dashed lines indicate the 10th and 90th quantiles of results.",
  "Black dot with error bars is the observed mean and min/max value",
   "(TODO REF)."
)
fig("summary-ts-plot.png")
```

Net primary productivity (NPP) and total leaf area index (LAI) varied with both parameter value and model structure (Figure \@ref(fig:summary-ts-plot)).
All model configurations exhibited a similar mean trajectory of rapid growth in the first 15-20 years followed by a gradual decline to a lower, stable value around 1975 (with individual ensemble members sometimes undergoing sudden collapse in specific years).
The ensemble spread within any single configuration---i.e. the parameter uncertainty---was similar and large across all configurations; both NPP and LAI varied from close to zero to more than twice the mean value at any given timestep.
Within all configurations, most (>90%) ensemble members under-predicted observed present-day NPP and LAI by year 2000, though individual ensemble members from some configurations over-predicted one or both variables.
Predictions of peak NPP (between 1910 and 1950 for most simulations) were closer to the observed present-day NPP (though also with large ensemble spread), but predictions of LAI during this period were still too low.

```{r pairs-time, fig.cap = pairs_time_cap}
### Figure 7
pairs_time_cap <- paste(
  htmlfig(),
  "ED-2.2 predictions of annual mean NPP and growing-season LAI",
  "averaged over 1925-1950 (left) and 1975-1999 (right)",
  "by model type.",
  "Each point indicates a single ensemble run with a different set of parameters.",
  "Solid line is the best-fit generalized additive model (GAM).",
  "Dashed lines indicate the error bounds of present-day observed NPP and LAI.",
  "Text labels match the rows in Figure 9 below."
)
fig("npp-lai-pairs.png")
```

The emergent relationship between NPP and LAI was similar across model configurations early in the runs, but became more sensitive to model configuration later into the runs (Figure \@ref(fig:pairs-time)).
Compared to runs with a closed canopy, runs with a finite canopy usually had higher LAI for the same NPP, especially later into the simulation.
Although many simulations matched _either_ the observed NPP or the observed LAI, only a small minority of individual runs matched _both_.

```{r pft-jitterplot, fig.cap = pft_jitterplot_cap}
### Figure 8
pft_jitterplot_cap <- paste(
  htmlfig(),
  "Fraction of total aboveground biomass (AGB)",
  "of each plant functional type (PFT)",
  "predicted by different parameter-configuration combinations",
  "of ED2.",
  "Each point represents the AGB fraction of a single PFT",
  "in a single ensemble member at the given point in time."
)
fig("pft-jitterplot.png")
```

The large parameter uncertainty in NPP and LAI also extended to species composition (Figure \@ref(fig:pft-jitterplot)).
Under all configurations, at any moment in time, most ensemble members were dominated by a single PFT, and the sustained coexistence of more than two PFTs was limited to only a handful specific ensemble members across all configurations.
However, _which_ PFT was dominant depended strongly on parameter values, and any of the four PFTs became the dominant one in some subset of simulations.

```{r lai-pft-plot, fig.cap = lai_pft_cap}
### Figure 9
lai_pft_cap <- paste(
  htmlfig(),
  "PFT-level predictions of leaf area index (LAI) by model configuration and parameterization.",
  "Each row of plots is a simulation with the same set of parameters across model configurations.",
  "Letters correspond to the labels in Figure 7.",
  "Note that these are predictions of total leaf area index summed across all cohorts of the same PFT,",
  "meaning that higher LAI in one PFT does not necessarily indicate dominance, size, etc."
)
fig("lai-pft.png")
```

Model structure and parameters interacted to determine the community assembly and dynamics of each simulation, with consequences for overall ecosystem productivity that varied by model structure (Figure \@ref(fig:lai-pft-plot)).
Parameter sets **A** and **B** both resulted in similar patterns of immediate and complete dominance by mid- and late-hardwood, respectively, followed by gradual decline to near-zero LAI.
In both of these simulations, peak productivity was higher and more sustained when the canopy was closed rather than finite, and this difference was larger under a two-stream rather than a multiple-scatter RTM.
Trait plasticity had relatively little effect on most of these two simulations, though in parameter set **B**, under the combination of closed canopy, multiple-scatter RTM, and plastic traits, pine overtook the dominant late hardwood PFT starting around 1975.
Both of these parameter sets also had the lowest LAI of the five selected here, with a peak LAI of 1 in **A** and 2 in **B**.
Parameter set **C** showed much more variety in compositional dynamics with model structure:
In all cases, mid-hardwoods began as the dominant species and were eventually overtaken by either pine (closed canopy and plastic traits) or early hardwood (all other cases; though with a closed canopy and static traits, the final LAI was low).
Parameter sets **D** and **E** had the highest productivity of these five sets, and were characterized by strong dominance of Early Hardwood and Pine, respectively.

```{r partial-variance-npp, fig.cap = partial_variance_npp_cap}
### Figure 10
partial_variance_npp_cap <- paste(
  htmlfig(),
  "Contributions of individual parameters to predicted uncertainty in",
  "average net primary productivity (NPP) over the period 1920-1950",
  "by model type.",
  "Each panel shows the top 8 parameter values by their fractional contribution",
  'to parameter uncertainty ("partial variance").',
  "Input parameter distributions are shown in Figure 3.",
  "Note that x-axis scales vary across panels."
)
fig("partial-variance-npp.png")
```

The parameters that contributed most to predictive uncertainty in NPP during the "peak" period (1920-1950) ("partial variance") varied with model structure (Figure \@ref(fig:partial-variance-npp)).
The "water availability factor" (a.k.a. plant-soil water conductance) for early hardwoods was the most or second-most important parameter for all but one model configuration (the ED-2.2 default---closed canopy, two-stream RTM, static traits---where it was not even in the top 8), and was particularly important in simulations with a finite canopy.
The growth respiration factor, particularly of pine and, to a lesser extent, early hardwood, was also among the most influential parameters across most configurations.
Which parameters were most important, and how important they were, varied with model configuration.
For instance, the C balance ratio of mortality (`mort2`) of early hardwoods was among the top four most important parameters when the canopy was closed but mattered less when the canopy was finite.
Similarly, parameters related to leaf optical properties had relatively higher importance in simulations with the two-stream model than the multiple-scatter model.

# Discussion

## ED-2.2 vs. reality

The overarching objective of this study was to investigate how model structure and parameters interact in multidecadal simulations of forest ecosystem productivity and community assembly.
Our first question was: To what extent can the model, under any configuration, reproduce the observed reality?
**Ensemble average trajectory matches traditional understanding of succession**---rapid growth to peak productivity, followed by gradual decline [@odum_1969_strategy_ecosystem_development]---but **happens too quickly** (Figure \@ref(fig:summary-ts-plot));
real ecosystems sustain peak productivity for longer [@gough_2016_disturbance].
One possible reason for the excessive pace of succession in ED-2.2 is **missing mechanisms for sustaining productivity through early succession**.
In particular, recent evidence points to the **importance of low-severity, high-frequency disturbances** in sustaining ecosystem productivity [@gough_2016_disturbance].
ED2.2 has a mortality scheme, and indeed, parameters related to mortality were often among the most important parameters for predictive uncertainty (Figure \@ref(fig:partial-variance-npp)).
<!-- Maybe move this elsewhere? -->
<!-- TODO Look at mortality across ED runs. Does it relate at all to results? -->
However, although our simulations used real meteorology (which included occasional extreme weather events), **we did not consider other sources of disturbance** common to this region [such as harvests, insects and pathogens, and fire; @amiro_2010_ecosystem], which may contribute to sustaining productivity and dominance of early-successional forests [@gough_2016_disturbance].
Future work will: (1) Calibrate ED2.2 disturbance response to experimental observations (FoRTE), and (2) run long-term simulations with prescribed disturbance frequencies and see how they affect ecological dynamics.

Under all but a small minority of parameter combinations, **ED-2.2 was unable to create---let alone sustain---a forest with any appreciable functional diversity**.
The large majority of runs produced dominance by a single PFT, though _which_ PFT dominated depended on parameter combination.
This highlights the difficulty of representing plant functional diversity in vegetation models, which has been true in other models as well [@fisher_2015_taking].
To the extent that ED-2.2 is "correct" in how it represents processes, this result also indicates that the plant functional trait space of realized niches is small---i.e. multiple different trees can co-exist only under very specific combinations of plant traits and environmental conditions (REFS).

Most ED-2.2 runs under-predicted both NPP and LAI, both in the peak period (1920-1950) and towards the end of the simulation (1975-1999) (Figures \@ref(fig:summary-ts-plot), \@ref(fig:pairs-time)).
However, of our five selected representative runs, the two that most closely matched present day composition at UMBS (early hardwood-dominated; **C** and **D** in Figure \@ref(fig:lai-pft-plot)) also closely matched the observed NPP and LAI (Figure \@ref(fig:pairs-time)).
This is encouraging because it suggests that it is possible to get both aggregate ecosystem C fluxes and PFT composition right.
Moreover, given that many important ED-2.2 parameters were well-constrained in our analysis (\@ref(fig:param-dist)), this is possible without using physically unrealistic parameter values.
We therefore suggest that for model calibration and validation, comparisons against multiple output variables---including variables related to composition---can yield maximum constraint and are not unreasonably strict.

## Drivers of uncertainty

Our second question was: What is the relative contribution of structural and parameter uncertainty to C cycling and ecological dynamics at UMBS?
We found that **parameter uncertainty was by far the dominant driver of uncertainty in our simulations**.
Different parameter combinations led to **huge ranges in ensemble predictions of ensemble variables**, with NPP and LAI ranging from zero to more than twice the ensemble mean estimates (Figures \@ref(fig:summary-ts-plot), \@ref(fig:pairs-time)).
Moreover, different parameter combinations produced **qualitatively different ecological narratives** (Figures \@ref(fig:pft-jitterplot). \@ref(fig:lai-pft-plot)).
Therefore, **parameter uncertainty has implications beyond C cycling**---differences in species composition and relative abundance have implications for forest management and wildlife conservation, among others (REFS).

The dominance of parameter uncertainty over structural uncertainty in our results suggests that **constraining parameter uncertainty should be a higher priority than model development**.
Parameter uncertainty can be reduced in two different ways:
Directly constraining parameters using observational data (for parameters that can be observed directly, such as plant functional traits) [@lebauer_2013_facilitating],
or indirectly constraining parameters through algorithmic model calibration techniques [@fer_2018_linking].
For example, leaf optical properties (i.e. reflectance, transmittance) are both measurable and highly influential [Figure \@ref(fig:partial-variance-npp); see also @viskari_2019_influence], and therefore should be a priority for new data collection.
In contrast, "growth respiration factor" is an empirical coefficient and not measurable, but highly influential [Figure \@ref(fig:partial-variance-npp); see also @dietze_2014_quantitative; @raczka_2018_what], and therefore should be constrained through calibration.

**Importantly, efforts to reduce model uncertainty are most effective when they target parameters that are poorly constrained and to which the model is most sensitive**.
For parameters that are already well constrained by data, the marginal value of additional measurements may be limited.
For example, ED-2.2 is highly sensitive to SLA [@dietze_2014_quantitative; @pandit_2018_optimizing], but thanks to the large number of SLA observations, we were able to estimate it very precisely (Figure \@ref(fig:param-dist)) and, as a result, it was not a significant source of uncertainty in our analysis (Figure \@ref(fig:partial-variance-npp)).
At the same time, some poorly constrained parameters have relatively modest impacts on model outputs---for instance, nonlocal dispersal and background mortality rate in our study (Figure \@ref(fig:param-dist), \@ref(fig:partial-variance-npp))---and therefore, reducing their uncertainties is not an effective way to improve model predictions.
Ultimately, this points to the value of model-data feedbacks [@dietze_2013_improving] in advancing ecological research and setting future research agendas.

Although parameter uncertainty was larger in magnitude than structural uncertainty, model structure played an important role in shaping the nature of that uncertainty.
The consequences of individual model structure changes were *usually* modest, but with several dramatic exceptions (Figure \@ref(fig:default-median-flux)).
Moreover, we found bi-directional interactions between structural and parameter uncertainty:
Different parameter values (especially ones far removed from ED-2.2 defaults) influenced ED-2.2 sensitivity to structural changes (Figures \@ref(fig:default-median-flux), \@ref(fig:default-median-lai)),
and changes to model structure in turn changed the relative importance of specific parameters to overall uncertainty (Figure \@ref(fig:partial-variance-npp)).
Collectively, this means that **sensitivity and uncertainty analyses are not necessarily generalizable across models**, and highlights the importance of model intercomparison studies.
It also reinforces our argument that changing model structure---particularly if such changes increase model complexity---should be pursued with extreme caution.

# Conclusions

{TODO}

# Acknowledgements

<!-- TODO Fill in Acknowledgements -->
This project was supported by NSF Award 1655095.
Cyberinfrastructure capabilities were provided by the Pacific Northwest National Laboratory (PNNL).
Data from University of Michigan Biological Station (UMBS).
Data from TRY (TODO: Specific TRY statement).

<!-- The following line inserts a page break when the output is MS Word. For page breaks in PDF, use \newpage on its own line.  -->
<!-- ##### pagebreak -->

\newpage

# References
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

<!-- ##### pagebreak -->

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies:

```{r colophon, cache = FALSE}
# which R packages and versions?
devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? You may need to change the path value
# if your Rmd is not in analysis/paper/
git2r::repository(here::here())
```

View this project on GitHub in repository [ashiklom/fortebaseline](https://github.com/ashiklom/fortebaseline)
(this manuscript file is in [`analysis/paper/paper.Rmd`](https://github.com/ashiklom/fortebaseline/blob/master/analysis/paper/paper.Rmd))
and in Open Science Framework (OSF) at https://osf.io/dznuf/ .
