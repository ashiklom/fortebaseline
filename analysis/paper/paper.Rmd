---
title: "FoRTE baseline"
author:
  - Alexey N. Shiklomanov
  - Ben Bond-Lamberty
  - Jeff Atkins
  - Christopher M. Gough
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
    bookdown::html_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
    pdf_document:
      latex_engine: xelatex
bibliography: references.bib
csl: "../templates/ecology.csl"
abstract: |
  Forests in the US Upper Midwest have been a net C sink for a century, driven by their fast-growing, early successional species. 
  However, the composition of these regrown forests has started to shift toward mid-successional species. 
  Combined with changing climate and disturbance, this means that future biogeochemical and ecological dynamics in these forests are highly uncertain. 
  Demographic vegetation models provide a tool for analyzing this uncertainty and its implications. 
  Here, we evaluate the relative importance of model "structural" (which processes are represented, and how) and "parameter" (parameters used in those equations) uncertainty, asking: 
  (1) Which processes are most important to accurately model community succession and C cycling in Upper Midwest forests?
  (2) What are the relative contributions of parameter vs. structural uncertainty? We ran ensembles of the Ecosystem Demography model v2.2 (sampling over parameter uncertainty) from 1900 to 2000 with different representations of key processes important to competition for light.
  We then compared the magnitude of structural (across representations) and parameter (within each representation) uncertainty, and assessed which submodel-parameter combinations reproduced observed C fluxes and succession.
  Our simulations agreed well with observed net primary productivity but systematically underestimated leaf area index.
  Overall, parameter uncertainty contributed more than structural uncertainty to total simulation uncertainty, but the amount of parameter uncertainty varied with model structure.
  We conclude that: (1) targeted data collection to constrain vegetation model parameters should be a higher priority than model development; (2) parameter sensitivity analyses are not necessarily generalizable across model structures; and (3) robust model validation requires scrutiny of multiple different variables, including those related to vegetation productivity, structure, and composition.
keywords: |
  Dynamic vegetation modeling; carbon cycle; forest succession
highlights: |
  These are the highlights.
---

```{r, setup, echo = FALSE}
library(knitr)
library(here)
library(drake)

fig <- function(...) {
  filepath <- here("analysis", "figures", ...)
  knitr::include_graphics(file_in(filepath))
}

opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>"
  ## fig.path = "../figures/"
)

## library(fortebaseline) # Or use devtools::load_all('.', quiet = T) if your code is in script files, rather than as functions in the `/R` diretory
n <- 0
mdcap <- function(text) {
  n <<- n + 1
  out <- sprintf("**Figure %d**: %s", n, text)
  if (grepl("gfm", knitr::opts_knit$get("rmarkdown.pandoc.to"), ignore.case = TRUE)) {
    out
  } else {
    invisible(NULL)
  }
}
m <- 0
htmlfig <- function() {
  m <<- m + 1
  out <- paste0("**Figure ", m, "**:")
  if (grepl("html", knitr::opts_knit$get("rmarkdown.pandoc.to"), ignore.case = TRUE)) {
    out
  } else {
    invisible(NULL)
  }
}
```

# Introduction

**Forests are a defining feature of the US North**.
This region is the most heavily forested region in the US, and these forests are an essential provider of employment and recreation opportunities and other ecosystem services for the region's people, and of habitat for the region's wildlife [@shividenko_2005_forest; @shifley_2012_forests].
In addition, the **forests of the Upper Midwest** in particular have been a **net carbon sink** for most of the past century, as fast-growing early successional species established and thrived following near-complete deforestation around the end of the 19th Century [@birdsey_2006_forest; @williams_2012_carbon].
However, the **fate of these forests is highly uncertain**.
For one, many Upper Midwest forests are undergoing a **shift in community composition from early-successional to mid-successional** species, and the ecological and biogeochemical consequences of this transition are not well-established [@gough_2016_disturbance].
In addition, these forests face a multitude of **direct and indirect pressures from both biotic and abiotic sources** [@shifley_2016_future], including longer and more severe droughts [@gustafson_2016_implications; @swanston_2017_vulnerability; @lienard_2016_us], non-native insects and pathogens [@lovett_2016_nonnative], and more. <!-- TODO More here? -->
Collectively, these processes have culminated in forests that are different from their pre-settlement climax counterparts [@stearns_2002_one; @wolter_2002_recent; @thompson_2013_four], and **our ability to make predictions about such non-analog environments based on the past is limited**.

**More reliable predictions can in theory be obtained by using dynamic vegetation models that explicitly represent processes involved in forest growth and mortality.**
Vegetation models fall broadly along the following spectrum of complexity, which is a direct consequence of trade-offs between **realism and process fidelity** on one hand and **tractability, computational demand, and data requirements** on the other [@hawkes_2000_woody]. <!-- TODO Might need a better ref here -->
On one side are relatively simple **"big leaf" models**---such as PNET, SiBCASA, and Biome-BGC---in which the vegetation at a particular location consists essentially of a single large "plant" whose characteristics are the (weighted) average of all the vegetation at that site.
A common application of these models was simulating the land surface boundary condition for atmospheric general circulation models, though similar models have been (and continue to be) applied successfully to simulate biogeochemical processes in many ecosystem science contexts. <!-- TODO refs -->
On the other end of the spectrum are **"individual-based" models** (a.k.a. "gap models"), which explicitly simulate multiple indivduals competing for resources at a single site [@shugart_2015_computer]. <!-- TODO other refs? -->
Examples of such models are LANDIS [@mladenoff_2004_landis; @scheller_2007_design] and UVAFME. <!-- TODO ref --> <!-- TODO Other examples? -->
Because these models can explicitly represent inter-specific differences in plant productivity, resource allocation, and stress tolerance (among others), as well as the competition that emerges out of these differences, they may be better able to represent changes in ecosystem-scale processes, especially in no-analog conditions [@purves_2008_predictive].
Between these two extremes are models that use approximations attempt to capture the emergent biogeochemical and ecological outcomes of interactions between individual plants without the need for explicitly simulating each individual [@purves_2008_predictive].
One specific example of this approach is the **Ecosystem Demography model** [ED2; @moorcroft_2001_method; @medvigy_2011_predicting; @longo_2019_ed1], which is the focus of this study.

**Regardless of vegetation model complexity, their projections are inherently uncertain.** 
This uncertainty comes from many different sources, which can broadly be classified into the following categories:
_Driver_ uncertainty refers to uncertainty in data about processes not represented by the model (e.g. weather and climate for vegetation models).
_Initial condition_ uncertainty arises from the fact that models have to start somewhere, and the exact conditions at the place and time simulations begin are frequently unknown.
_Process_ or _structural_ uncertainty arises because vegetation models necessarily only represent a subset of all processes involved in plant biology, and that the process that are included can usually be represented in multiple different ways (i.e. which processes are included, and how they are represented).
Finally, _parameter_ uncertainty arises because of natural variability and imperfect calibration of the above process representations.
**The relative importance of these sources of uncertainty in ecological forecasts is a key question because it is directly related to future research priorities**.
For example, in the atmospheric science community, the insight that meteorological forecasts were most sensitive to initial condition uncertainty (Lorenz REF<!-- TODO others? -->) led to a multi-decadal research agenda aimed at constraining the initial state with improved observations, which has directly contributed to a steady and persistent improvement in meteorological forecasts over the last several decades. <!-- TODO Holy run-on sentences, Batman! --> <!-- TODO REFS! -->

**Many ecosystem modeling studies have looked at these categories of uncertainty independently.**
Perhaps the most work has been done on **parameter uncertainty** in ecosystem models.
<!-- TODO Consider cutting 50-75% of these next few sentences. Probably way too much detail. -->
@dietze_2014_quantitative investigated which parameters were most important to ED2 predictions of C sequestration across a diverse range of sites in North America.
The found that the parameters contributing the most to overall predictive uncertainty were those related to growth respiration, mortality, stomatal conductance, and water uptake, and that parameter uncertainty varied with biome.
More recently, @raczka_2018_what evaluated parameter uncertainty over 100 year time scale at the Willow Creek Ameriflux site, and found that the most important parameters to model uncertainty were quantum efficiency of photosynthesis, leaf respiration, and soil-plant water transfer.
Another recent study assessed parameter uncertainty in ED2 as part of its overall goal of parameterizing the model for sagebrush [@pandit_2018_optimizing].
They found that the most important parameters were specific leaf area, the maximum rate of carbon fixation (V~cmax~), slope of stomatal conductance, the fine-root to leaf carbon ratio, and the fine root turnover rate.
Another study looked specifically at contributions to uncertainty from parameters related to canopy radiative transfer, and found that parameters related to both canopy structure and leaf optical properties had a large impact on predictions of net primary productivity [@viskari_2019_influence].
{**Driver uncertainty** -- a few examples?}
**Other studies have investigated structural uncertainty.**.
Numerous vegetation model intercomparison studies have demonstrated that different models produce significantly different projections of overall land carbon sequestration [@friedlingstein_2006_climate; @friedlingstein_2014_uncertainties], response to CO~2~ fertilization [@zaehle_2014_evaluation; @medlyn_2015_using; @walker_2015_predicting], and soil C sequestration [@sulman_2018_multiple], among others.
In particular, @lovenduski_2017_reducing found that model structural uncertainty was the primary source of uncertainty in Earth system model projections of the land C sink.
This structural uncertainty has been attributed to differences in model representations of key processes, including canopy radiative transfer [@fisher_2017_vegetation], soil biogeochemistry [@wieder_2017_carbon; @sulman_2018_multiple], stomatal conductance [@franks_2018_comparing], and photosynthesis [@rogers_2016_roadmap].
**However, the extent to which specific processes contribute to model uncertainty is difficult to evaluate from model intercomparisons because different models are different from each other in too many different ways, meaning that structural effects are confounded with other uncertainty sources.**
**Moreover, comparative analysis of contributions of different types of uncertainty to model projections are rare in the ecosystem modeling literature**.
<!-- 
TODO Do we have any examples? Or are these studies entirely non-existent?

Ben's notes:which of the last two categories--structural versus parametric uncertainty--is more important (Fisher et al. 2015, https://onlinelibrary.wiley.com/doi/full/10.1111/j.1523-1739.2003.00614.x, Ricciuto et al. 2008).
-->

**This study focuses on the interaction between parametric and structural uncertainty in the ED2 model.**
Our study is organized around the following guiding questions:
(1) Which processes related to light utilization are most important to accurately modeling community succession and C cycle dynamics in temperate forests of the Upper Midwest?
(2) What is the cost of considering these processes, in terms of additional parametric uncertainty?
(3) What are the relative contributions of parametric uncertainty (data limitation) vs. structural uncertainty (theoretical limitation?)?
To answer these questions, we ran ED2 ensemble simulationes with a factorial combination of submodels related to radiative transfer formulation (two-stream vs. multiple scatter), horizontal competition (finite canopy radius vs. complete shading), and trait plasticity (whether or not SLA and Vcmax vary with light level)
We then used sensitivity and variance decomposition analyses to evaluate the contribution of parameter uncertainty for each model configuration, exploring the ecological implications of the results.

# Methods

## Site description

We performed this study at the University of Michigan Biological Station (UMBS; Ameriflux site US-UMd, 45.5625$^{\circ}$, -84.6975$^{\circ}$), located in Northern Lower Michigan, USA.
The area surrounding the research station is 87% well-drained upland forest and 13% wetland [@bergen_2007_observing]; the focus of this study is on the former.
The landscape geography of the UMBS upland forest is 20.4% moraine, 37.8% high outwash plain, 31.3% low outwash plain, 5.7% lake-margin terrace, 3.6% ice-contact, and 1.2% lowland glacial lake [@bergen_2007_observing].
Most of the UMBS upland forest canopy is dominated by temperate deciduous early-successional species, most importantly _Populus grandidentata_ (bigtooth aspen) and, to a lesser extent, _Betula papyrifera_ (paper birch), with _Acer saccharum_ (sugar maple), _Acer rubrum_ (red maple), _Fagus grandifolia_ (American beech), _Tilia americana_ (basswood), _Betula alleghaniensis_ (yellow birch), _Fraxinus americana_ (white ash), _Tsuga canadensis_ (eastern hemlock), _Quercus rubra_ (northern red oak), _Pinus strobus_ (white pine), and _Pinus resinosa_ (red pine) existing in various fractions in the understory (and, in patches, in the canopy).
This composition is a legacy of the site's disturbance history:
The site was intensively logged in the late 1800s and early 1900s, and experienced regularly recurring fires until the mid-1920s, at which point a regime of active fire suppression started that has persisted to the present day. <!-- TODO ref -->
As a result, the average stand age in 2013 was 95 years. <!-- TODO ref -->
The majority of the forest that is aspen-dominated is undergoing succession to "northern hardwood" (maple, beech, basswood, birch, ash, hemlock), "upland conifer" (red and white pine), or "northern red-oak" ecotypes [@bergen_2007_observing].


## Ecosystem Demography Model (version 2.2)

For this study, we used the Ecosystem Demography Model, version 2.2 (ED-2.2).
A full description of the default configuration of the model is provided by @longo_2019_ed1.
Briefly, ED-2.2 solves the energy, water, and carbon cycles separately for each of multiple "cohorts" of trees of similar composition, size, and age sharing a micro-environment and disturbance history [@moorcroft_2001_method; @medvigy_2009_mechanistic; @longo_2019_ed1].
Besides the cohort-based approximation of gap dynamics, a distinctive feature of ED-2.2 is that the equations for energy, water, and carbon fluxes are defined in terms of total energy, water, and carbon, which ensures excellent conservation of mass in long-running (multidecadal) simulations [@longo_2019_ed1].
Various versions of the ED model have been validated in boreal [@medvigy_2011_predicting], temperate [@medvigy_2009_mechanistic; @dietze_2014_quantitative; @raczka_2018_what], and tropical biomes [@moorcroft_2001_method; @longo_2019_ed2], and have been applied in, among others,
paleoecological studies [@rollinson_2017_emergent],
free-air CO~2~ enrichment studies [@dekauwe_2013_forest; @miller_2015_alteration],
estimation of potential carbon stocks [@hurtt_2004_beyond_potential_vegetation],
and analyses of regional vegetation-climate feedbacks [@swann_2015_future].

The official ED2 source code is available at https://github.com/EDmodel/ED2, and the exact version used in this study (which includes minor revisions to accommodate the requirements of this study) can be obtained at https://github.com/ashiklom/ED2/tree/b048950971e91699b78fc566df133caf977fda32.

## Submodels

In this study, we ran a factorial combination of the following ED-2.2 configurations: (1) two-stream vs. multiple-scatter canopy radiative transfer models; (2) infinite vs. finite crown area (a.k.a. complete vs. partial shading); and (3) static vs. light-plastic traits.

Both canopy radiative transfer models in ED-2.2 resolve the full vertical radiation profile within a patch as a function of canopy structure (leaf and wood area indices, crown area, leaf angle distribution) and incident solar radiation, following the definitions in CLM 4.5 [@clm45_note].
Both models also use identical definitions for the optical properties of a single canopy layer as a function of leaf and wood optical properties, leaf angle distribution, canopy clumping, solar zenith angle, and leaf, wood, and crown area indices.
Both models represent direct (a.k.a. "beam") radiation as an exponentially decaying process, and solve for the diffuse (a.k.a. "hemispherical", "isotropic") radiation at each layer using a linear matrix equation.
Where the models differ is in the terms of this matrix equation.
The two-stream model (default) uses the two-stream approximation originally derived for atmospheric radiative transfer [@meador_1980_two] and later adapted to vegetation canopies [@dickinson_1983_land; @sellers_1985_canopy].
Meanwhile, the multiple-scatter model was derived from first principles by @zhao_2005_multiple specifically for vegetation canopies, specifically to address known biases and limitations of the two-stream approach [e.g. @wang_2003_comparison].
Both of these models are described in detail in the Supplementary Information. <!-- TODO Exact reference to Appendix -->

The crown area submodel in ED-2.2 determines the nature of competition for light between cohorts.
In the default configuration ("infinite crown area", or "complete shading"), the leaf area of a cohort is distributed across the entire horizontal area of a patch.
This means that taller cohorts always receive more incoming radiation than shorter cohorts, even when the height difference is small.
This has been shown to excessively suppress competition from sub-dominant individuals and result in unrealistically homogeneous canopies [@fisher_2015_taking].
In the alternate configuration ("finite crown area", or "partial shading"), canopies take up only a fraction of the available horizontal area, meaning that multiple cohorts of similar height can receive the same level of light.
The horizontal area of crowns is determined by allometric equations from @dietze_2008_changing.

The third submodel we evaluated was trait plasticity.
In the default configuration, all cohorts of a given plant functional type will have the same parameters, regardless of environmental conditions.
This ignores the globally-documented intraspecific trait variability as a function of light level [@niinemets_2010_review; @keenan_2016_global]. <!-- TODO Also, classical ecological succession theory bazzaz_1979_physiological? -->
In the alternate configuration, as light level decreases (trees become more shaded), specific leaf area increases and V~cmax~ decreases, following empirical relationships from the tropics [@lloyd_2010_optimisation].

These sub-models are summarized in Table 1.

Table 1: ED-2.2 submodel descriptions

| Name                         | Description                                                                          | Color                     |
|------------------------------|--------------------------------------------------------------------------------------|---------------------------|
| **Crown model**              |                                                                                      |                           |
| `closed` (default)           | Cohort crowns take up entire patch area. Competition for light based only on height. | Light                     |
| `finite`                     | Cohort crown area is proportional to DBH according to PFT-specific allometry.        | Dark                      |
| **Radiative transfer model** |                                                                                      |                           |
| `two-stream` (default)       | Two-stream approximation [@sellers_1985_canopy; @clm45_note]                         | Primary (red, blue)       |
| `multi-scatter`              | Multiple-scatter approximation, following [@zhao_2005_multiple]                      | Secondary (green, orange) |
| **Trait plasticity**         |                                                                                      |                           |
| `static` (default)           | SLA and V~c,max~ are constant                                                        | Cool (blue, green)        |
| `plastic`                    | SLA increases, and V~c,max~ decreases, with light level                              | Warm (red, orange)        |


## Parameter descriptions

The full list of parameters in ED-2.2 is large, with over 100 parameters per plant functional type.
A full sensitivity and uncertainty analysis across all of these parameters is outside the scope of this study.
Instead, we selected a subset of parameters guided by (but expanding upon) previous ED2 sensitivity studies [@dietze_2014_quantitative; @raczka_2018_what; @viskari_2019_influence].

Three parameters are related to leaf-level physiology:
Following the enzyme-kinetic model of @farquhar_1980_biochemical, the rate of photosynthesis is the minimum of light-limited and enzyme-limited reactions.
The former are controlled by the _quantum efficiency_ parameter---maximum efficiency with which absorbed photosynthetically active radiation is converted to CO~2~.
The latter are controlled by _V~cmax~_, the maximum rate of carbon fixation by Rubisco.
The water demand of photosynthesis is controlled by the _stomatal slope_, the sensitivity of stomatal conductance of CO~2~ as a function of CO~2~ concentration and humidity at the leaf surface [@leuning_1995_critical; @ball_1987_model].
Three more parameters correspond to the respiration rates of _leaves_, _roots_, and "_growth maintenance_".

Two more parameters control carbon allocation:
One is the ratio of fine root to leaf biomass (`fineroot2leaf`, or `q`), and another is the ratio of "storage" carbon allocated to reproduction (`r_fract`).

Three parameters control various aspects of adult tree mortality.
The overall adult mortality rate in ED-2.2 ($M$) is the sum of density-independent mortality from aging ($M_I$, plants year^-1^), density-dependent mortality from C starvation ($M_D$), and mortality from cold/frost ($M_F$) (ED-2.2 technically also includes additional term for fire mortality, but we did not include fire in our simulations):

$$
M = M_I + M_D + M_F
$$

Density-independent mortality from aging ($M_I$) is a prescribed, PFT-specific parameter (`mort3`).
Density-dependent mortality from C starvation is calculated as a function of a cohort's C balance limitation:

$$
M_D = \frac{y_1}{1 + \exp\left[y_2 \left( \frac{C_k}{C_k^*} \right)\right]}
$$

where $C_k$ is the 12 month running mean C balance of the cohort, $C_k^*$ is the running mean ideal C balance if there was no light or water limitation, and $y_1$ (`mort1`; plants year^-1^) and $y_2$ (`mort2`; unitless) are PFT-specific parameters.
_Seedling mortality_ rate is prescribed as its own PFT-specific parameter.

Several parameters are related to canopy structure and radiative transfer.
_Specific leaf area_ (`SLA`) is used to convert leaf biomass to leaf area index, which in turn is used in a variety of calculations related to canopy radiative transfer and micrometeorology.
Canopy _clumping factor_ describes how evenly leaf area is distributed in horizontal space (1 being perfectly evenly; 0 being a "black hole" where all leaves are concentrated in a single point); and
leaf _orientation factor_ describes the average distribution of leaf angles (-1 being perfectly vertical, 1 being perfectly horizontal, and 0 being random).
Four parameters control leaf optical properties, namely the fractions of light reflected or transmitted in visible and near-infrared wavelengths (`leaf_(reflect|trans)_(vis|nir)`).
Details of how these parameters influence canopy radiative transfer are described in the Supplementary Information.

Other parameters:

- Fraction of litter carbon that enters the labile (fast) soil carbon pool (`f_labile`)
- Minimum plant height for reproduction (`minimum_height`)
- Soil-plant water conductance, or "water availability factor" (`water_conductance`)
- C:N ratio in fine roots (`c2n_fineroot`) and leaves (`c2n_leaf`)
- Leaf turnover rate (evergreen-only; `leaf_turnover_rate`)
- Proportion of dispersal that is "global" (`nonlocal_dispersal`) <!-- TODO What is this? Can I drop it from the analysis? -->

The full list of parameters is shown in Table 2.

```{r param-table}
tbl <- readd(param_table)
tbl <- subset(tbl, Ran == "yes", select = c(-unit_parsed, -Ran))
tbl[["ED Name"]] <- sprintf("`%s`", tbl[["ED Name"]])
knitr::kable(tbl, escape = FALSE, caption = paste0(
  "Table 2: Parameter descriptions. ",
  "For additional information, see the ",
  "[ED2 model wiki](https://github.com/EDmodel/ED2/wiki/PFT-parameters)."
))
```

## Plant functional types and parameterization

By default, ED-2.2 supports 17 different plant functional types, which divide plant species according to photosynthetic pathway (C3 vs. C4), growth form (grass vs. tree), leaf phenology habit (deciduous vs. evergreen), biome (e.g. temperate vs. tropical), and successional status (e.g. early, mid, late).
However, we limited our simulations to the four plant functional types that have any appreciable presence at UMBS: Early, mid, and late temperate deciduous trees and pines.
The species comprising these plant functional types are shown in Table 3.

Table 3: Plant functional type-species mappings

| Plant functional type | Species                 | Color  |
|-----------------------|-------------------------|--------|
| Early hardwood        | _Betula papyrifera_     | Violet |
|                       | _Populus grandidentata_ |        |
|                       | _Populus tremuloides_   |        |
| Mid hardwood          | _Quercus rubra_         | Blue   |
|                       | _Acer rubrum_           |        |
|                       | _Acer pensylvaticum_    |        |
| Late hardwood         | _Acer saccharum_        | Green  |
|                       | _Fagus grandifolia_     |        |
| Pine                  | _Pinus strobus_         | Yellow |

For each plant functional type, we generated a distribution of parameter values via the Predictive Ecosystem Analyzer (PEcAn) trait-meta analysis [@lebauer_2013_facilitating; see also @dietze_2014_quantitative; @raczka_2018_what].
Prior distributions for this meta-analysis were largely adapted from previous ED2 parameter uncertainty studies [@dietze_2014_quantitative; @raczka_2018_what; @viskari_2019_influence], and are shown in detail in Supplementary Information X. <!-- TODO Priors supplement; maybe describe entire meta-analysis? -->
Species trait data for this meta-analysis came from existing records in the BETY database [www.betydb.org, @lebauer_2017_betydb], as well as from publicly available records in the TRY database [www.try-db.org, @kattge_2011_try] and, specifically for leaf optical properties, from Shiklomanov (2019 {dissertation, chapter 3}).
The resulting parameter distributions are shown in Figure 1.
<!-- TODO more on this? -->
All parameters not described in this section were set to their ED-2.2 PFT-specific default values.

```{r methods_captions}
param_dist_cap <- paste(
  htmlfig(),
  "Input parameter distributions from PEcAn trait meta-analysis."
)
```

```{r param_dist, fig.cap = param_dist_cap}
fig("param-dist.png")
```

`r mdcap(param_dist_cap)`


## Modeling workflow

For each factorial combination of ED-2.2 configurations (described above), we ran 100 ensemble members from 1901 to 2000.
Each ensemble member was initialized from a "near-bare ground" condition: An equal number of seedlings of each plant functional type (see previous section) at the minimum resolvable size.
Driving meteorological data was 6-hourly CRU-NCEP <!-- TODO ref. More here? --> combined with an annual atmospheric CO~2~ record from Law-Dome ice core [@etheridge_1998_historical] and Mauna Loa observatory [@thoning_1989_atmospheric].
Soil texture was set to 92% sand, 7% silt, and 1% clay, per site-level observations in [@gough_2010_wood].
The initial soil moisture profile was set to the average soil moisture profile reported in the UMBS Ameriflux ancillary data (https://ameriflux.lbl.gov/sites/siteinfo/US-UMd).

<!-- TODO This would probably fit better somewhere else.  -->
Driver uncertainty is outside the scope of this study, and initial condition uncertainty is minimized by our experimental design, which is conditioned on a specific initial condition (near bare ground).

## Analysis of results

- Overall summary:
    - Overall parameter uncertainty -- Time-series plots of total annual GPP and NPP, and maximum LAI and AGB, averaged across ensemble members
    - Impact of parameter uncertainty on ecological trajectories -- plot of max annual LAI by PFT
    - Both compared against observations of recently observed LAI and NPP at UMBS (e.g. FASET, FoRTE)
- Uncertainty analysis:
    - Parameter vs. structural uncertainty -- Variance in mean annual GPP from 19XX to 19YY across ensembles within model structure, and compare against 
    - Breakdown of parameter uncertainty -- PEcAn sensitivity and uncertainty analysis [@lebauer_2013_facilitating; @dietze_2014_quantitative]
- Details of structural uncertainty:
    - Vertical profiles of radiation, traits?
    
All analyses for this work were performed using R 3.6 (see "Colophon" for full details).
Code and supporting data for reproducing this analysis are publicly available on the Open Science Framework (OSF) at https://osf.io/dznuf/.

# Results

## Summary

```{r summary-ts-plot, fig.cap = summary_ts_cap}
summary_ts_cap <- paste(
  htmlfig(),
  "ED2 plot-level predictions of",
  "gross (GPP) and net (NPP) primary productivity,",
  "aboveground biomass (AGB),",
  "total leaf area index (LAI),",
  "and Shannon diversity index (of plant functional types)",
  "by model configuration.",
  "The solid line is the ensemble mean.",
  "The dashed line is the 80% confidence interval.",
  "Black dot with error bars is the observed mean and min/max value",
  "(TODO REF)."
)
fig("summary-ts-plot.png")
```

`r mdcap(summary_ts_cap)`

Model projections of gross and net primary productivity, aboveground biomass, leaf area index, and functional diversity varied with both parameter value and model structure (Figure 2).
All model configurations exhibited a similar trajectory of rapid growth in the first 15-20 years followed by a gradual decline to a lower, stable value around 1975 (with individual ensemble members sometimes undergoing sudden collapse in specific years).
Two model configurations -- finite canopy radius and two-stream radiative transfer (regardless of trait plasticity) -- had much lower productivity, biomass, and diversity than the other configurations, which generally had similar ensemble mean values and spread.
The ensemble means of all model configurations under-predicted observed net primary productivity and leaf area index, both at the peak of initial growth (around 1920) and at the end of the simulations, though peak predicted values were much closer to thte observations.
However, the ensemble spread around the mean was large:
across all configurations (except the finite canopy - two-stream radiative transfer cases), the spread in net primary productivity was from zero to nearly twice as high as the observation.
Ensemble variance in leaf area index was lower on average but, in some cases (especially the combination of finite canopy and multiple-scatter radiative transfer) was over an order of magnitude.
The predicted Shannon diversity index of plant functional types was, on average, higher in simulations when the canopy architecture was finite rather than closed.

```{r pairs-time, fig.cap = pairs_time_cap}
pairs_time_cap <- paste(
  htmlfig(),
  "Post-1975 growing season averaged NPP vs. LAI, with observation (in black)",
  "and linear regression, by model type.",
  "Each point indicates a single ensemble run with a different parameter combination.",
  "Letter labels are selected runs with the same parameters,",
  "and match the rows in Figure 4."
)
fig("pairs-time-averaged.png")
```

Model configuration affected the emergent relationship between net primary productivity and leaf area index (Figure 3).
The crown model (closed vs. finite) had the strongest effect:
Compared to the simulations with "closed" crowns, simulations with finite canopy radius generally had lower net primary productivity for the same leaf area index.
Although many simulations matched _either_ the observed net primary productivity or the observed leaf area index, only a few individual runs matched _both_.

```{r bigfacet-plot, fig.cap = bigfacet_cap}
bigfacet_cap <- paste(
  htmlfig(),
  "PFT-level predictions of leaf area index (LAI) by model configuration and parameterization.",
  "Each row of plots is a simulation with the same set of parameters across model configurations.",
  "Letters correspond to the labels in Figure 3.",
  "Note that these are predictions of total leaf area index summed across all cohorts of the same PFT,",
  "meaning that higher LAI in one PFT does not necessarily indicate dominance, size, etc."
)
fig("lai-pft-plot.png")
```

`r mdcap(bigfacet_cap)`

Model structure and parameters interacted to determine the community assembly and dynamics of each simulation, with consequences for overall ecosystem productivity that varied by model structure (Figure 4).
Consider simulations **A** and **C**, the former showing competition of early hardwood with pine, and the latter completely dominated by pine:
With a closed canopy and static traits, both simulations produced similar overall LAI and NPP values (Figure 3), but moving to a finite canopy dramatically increased the total LAI in **C** without much affecting **A**, while enabling trait plasticity dramatically increased the NPP of **A** without much affecting **C** (Figure 3).
This example also shows the impacts of different configurations on predicted community dynamics -- namely, in this specific case, enabling trait plasticity helped pine out-perform early hardwood, but only under a closed (rather than finite) canopy.
Finite canopy radius similarly benefits early hardwood in its competition against late hardwood in simulations **B** and, to a lesser extent, **D**.
Simulations **B** and **D** also show that the sensitivity of a given parameter combination to model structure is itself dependent on the parameters -- simulation **B** produced similar ecological dynamics and aggregate state variables regardless of model configuration (except the extreme cases; Figure 3), while simulation **D** had near-zero NPP and LAI in two cases (closed, two-stream, static and finite, multi-scatter, plastic), comparable NPP and LAI to **B** with closed canopy and trait plasticity, and higher NPP and LAI than **D** with a finite canopy, multi-scatter radiative transfer, and static traits (Figure 3).


## Uncertainty analysis

```{r within-vs-across, fig.cap = within_vs_across_cap, fig.dim = c(9, 4)}
within_vs_across_cap <- paste(
  htmlfig(),
  "Comparison of parametric uncertainty within ensembles (colored bars, colored by model type)",
  "and \"structural\" uncertainty (variance in ensemble means; black bar) by output variable.",
  "Output variables are expressed as growing season averages for all years after 1910."
)
fig("within-across-plot.png")
```

`r mdcap(within_vs_across_cap)`

Except for the configurations with persistently low productivity, parameter uncertainty (across ensembles within each model configuration) was much larger than structural uncertainty (variance in ensemble means across configurations; Figure 4).
The relative importance of parameter uncertainty varied with both model configuration and the variable in question.
Allowing SLA and V~cmax~ to vary with light level (warm colors, as opposed to static traits -- cool colors) slightly reduced variability in primary productivity, slightly increased variability in Shannon diversity, and had mixed effects on aboveground biomass and total leaf area.
Enabling the finite canopy radius (dark colors; compared to closed canopy -- light colors) dramatically decreased variability in primary productivity and Shannon diversity and increased variability in leaf area, and had mixed effects on aboveground biomass.
reduced variance in aboveground biomass, diversity, and primary productivity.
Finally, using a multiple-scatter (secondary colors) rather than a two-stream (primary colors) radiative transfer scheme increased variance in leaf area index, aboveground biomass, and diversity, but did not have a consistent effect on variance in productivity productivity.

```{r uncertainty-analysis, fig.cap = uncertainty_analysis_cap}
uncertainty_analysis_cap <- paste(
  htmlfig(),
  "PEcAn-like parameter sensitivity and uncertainty analysis, by model type,",
  "for 1975-2000 averaged growing season net primary productivity (left) and leaf area index (right).",
  "Elasticity (top) is the normalized sensitivity of the model to a fixed change in the parameter.",
  "Partial variance (bottom) describes the overall contribution of the parameter to model predictive uncertainty based on the combination of parameter uncertainty and model sensitivity.",
  "Each panel shows the top 10 parameter values, in terms of the absolute value of the corresponding quantity.",
  "Input parameter distributions are shown in Figure 1.",
  "Note that x-axis scales vary across panels."
)
fig("sensitivity-plot.png")
```

`r mdcap(uncertainty_analysis_cap)`

Model sensitivity to specific parameters ["elasticity" _sensu_ @lebauer_2013_facilitating] varied depending on the model configuration and the target output variable (Figure 5).
The parameter with the single highest elasticity to NPP and LAI across all model configurations was specific leaf area (SLA), though the PFT whose SLA was most important varied with model configuration.
Other frequently (but not always) important parameters were the leaf C:N ratio (`c2n_leaf`), ratio of fine root to leaf biomass (`fineroot2leaf`), leaf and root respiration rates, and leaf optical properties (`leaf_reflect_vis/nir`).
<!-- TODO Dig into model configurations. -->

The parameters that contributed most to overall model predictive uncertainty ("partial variance") differed from parameters to which the model was most sensitive (Figure 5), largely driven by the fact that many of the parameters with the highest sensitivity (e.g. SLA, V~cmax~) were also well constrained by data (Figure 1).
Leaf optical properties of at least one PFT were among the top 10 most important parameters across all configurations, and in multiple cases, were the most important.
Other often important parameters were plant-soil water conductance (`water_conductance`), parameters related to adult mortality (`mort1,2,3`), and growth respiration.
Again, patterns in partial variance were largely idiosyncratic across model configurations.
<!-- TODO Dig into this more -->
<!-- TODO Check this analysis. Look at pairs plots of trait vs. variable, and my SA spline fits. -->

# Discussion

- Parameter uncertainty is the dominant driver of model predictive uncertainty.
- ...but the nature of this parameter uncertainty depends on model configuration.

- Ecological implications of structural uncertainty
    - Predictions about ecological succession are very sensitive to the understory light environment.
        - Need a good representation of canopy structure (finite canopy radius)
        - How you model canopy radiative transfer matters! Small differences in the model can give significant results.
    - But, trait plasticity can provide an alternative mechanism for success in the understory.
        - Important modeling implication for all the emerging research on intra-specific trait variability.
        - This combination of discrete functional types with plastic traits is closer to reality than purely trait-based ("eco-evolutionary?") models or completely discretized models with static traits on the other.
        - Important caveat: Current implementation is based entirely on tropical data, which has more extreme canopy shading than temperate forests (REF), so tropical species may have evolved stronger trait plasticity than temperate species (REF).
        - Perhaps note "ecological equifinality" here: there are different ways to arrive at similar outcomes in the model; this is also true in nature? 
- Implications of uncertainty analysis for future data collection and model development
    - Parameter uncertainty is still a _huge_ source of overall model predictive uncertainty. Different parameters can give _qualitatively_ different ecological outcomes.
    - Looking beyond aggregate variables (e.g. net primary productivity, total LAI) is essential to model evaluation and calibration. It's possible to generate a relatively?
    - (Expected) Subsurface parameters (e.g. leaf-root ratios) have high sensitivity, but are poorly constrained.
    - Trait covariance may alleviate some data limitation (Shiklomanov et al. 2018 [preprint])
- Comparisons against other studies
    - Parameter sensitivity
        - [@pandit_2018_optimizing] -- Most important parameters for shrubs were SLA, Vcmax, stomatal slope, root:leaf ratio, and root turonver rate (slightly less important: leaf turnover rate, growth respiration, cuticular conductance; much less important: water conductance; basically irrelevant: storage turnover, leaf width)
        - Compare against @dietze_2014_quantitative and @raczka_2018_what
- Future directions: Predicting disturbance response
    - FoRTE project -- Forecasting a disturbance.
        - Compare ecological resilience/memory between model and reality
- Other relevant references:
  - @gough_2019_high -- Canopy structural complexity is the strongest predictor of productivity across NEON sites. Possible future direction?

Moreover, these models' **predictions of species composition and ecosystem structure are relevant outside of carbon cycle science**, particularly for forest management and wildlife conservation. <!-- BBL: maybe move this sentence to discussion? TODO refs -->

# Conclusions

<!-- TODO -->

# Acknowledgements

This project funded by NSF grant.
Cyberinfrastructure provided by Pacific Northwest National Laboratory (PNNL).
Data from University of Michigan Biological Station (UMBS).
Data from TRY (TODO: Specific TRY statement).

<!-- The following line inserts a page break when the output is MS Word. For page breaks in PDF, use \newpage on its own line.  -->
##### pagebreak

# References
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

# Appendix 1: Submodel descriptions

## Radiative transfer: Definitions

- $\omega$ -- Clumping factor
- $LAI$ -- Leaf area index
- $TAI$ -- Total area index (leaf and woody area)
- $LAI_e$ / $TAI_e$ -- "Effective" area indices (accounting for clumping)

## Two-stream RTM

<!-- TODO -->

## Multiple scatter RTM

Effective LAI is just true LAI x clumping.

$$ LAI_e = \omega LAI $$

Total area index (TAI) is leaf (LAI) + wood (WAI) area.

$$ TAI_e = LAI_e + WAI $$

Local exposed total area index ($TAI_l$) is the total area index divided by crown area index ($CAI$).

$$ TAI_{l} = \frac{TAI_e}{CAI} $$

Leaf ($w_l$) and wood ($w_w$) weights:

$$ w_l = \frac{LAI_e}{TAI_e} $$
$$ w_w = 1 - w_l $$

Projected area ($a_{proj}$), based on coefficients $\phi_1$ and $\phi_2$.

$$ a_{proj} = \phi_1 + \phi_2 \mu $$

Optical depth ($\lambda$) is projected area over optical depth ($\mu$)

$$ \lambda = \frac{a_{proj}}{\mu} $$

Transmittance for direct radiation of a canopy layer ($\tau_{beam}$) is:

$$ \tau_{beam} = (1 - CAI) + CAI exp\left( -\lambda TAI_l \right) $$

Transmittance for diffuse radiation of a canopy layer ($\tau_{diff}$):

$$ ext_1 = \phi_1 TAI_l $$
$$ ext_2 = \phi_2 TAI_l $$
$$ \tau_{diff} = (1 - CAI) - CAI exp\left( -ext_1 - ext_2 \right) ext_1^2 e^{exp_1} E_i(-exp_1) + (ext_1 - 1)$$

where $E_i$ is the exponential integral.

Single-scattering albedo ($w_0$):

$$ w_0 = \frac{1}{2} \frac{a_{proj}}{\phi_2 \mu + a_{proj}} \frac{1 - \phi_1 \mu}{\phi_2 \mu a_{proj}}
  \log \left( 1 + \frac{\phi_2 \mu + a_{proj}}{\phi_1 \mu} \right) $$
  
Beam backscatter ($\gamma$):
  
$$ \gamma = w_0 \frac{1 + \bar{\mu} \lambda}{\bar{\mu} \lambda} $$


# Old outline

## Introduction

- Why we need models?
    - Forests are important, for C sequestration, other ecosystem services
    - Policy decisions related to forests depend on future projections
    - We need models to make future projections
- What kinds of models are out there?
    - Traditional: "Big leaf" models
        - Needed to be simple to run on old computers
        - Don't need as much data
        - ...but they fail to capture important processes, which matter not only for accurate predictions about C cycle, but also because they are processes we care about (habitat, forestry, tourism, etc.)!
    - Individual-based models
        - Much more detailed, but harder to run, and need much more data.
        - Trade-off between complexity and accuracy.
- Cohort-based models like ED2 as a middle ground?
    - Core ED concept [@moorcroft_2001_method]
    - ED2 developments -- [@medvigy_2009_mechanistic; @medvigy_2011_predicting]
    - Most recent version -- [@longo_2019_ed1]
    - Validation/applications of the ED model:
        - [@rollinson_2017_emergent] -- ED2 paleoclimate
        - [@miller_2015_alteration] -- ED2 at Duke FACE
        - [@dekauwe_2013_forest] -- ED2 at Duke and Oak Ridge FACE
        - [@longo_2019_ed2] -- Model evaluation in Tropics
- How much complexity do we need to accurately model ecological dynamics?
    - Lots of existing work on parametric uncertainty
        - [@dietze_2014_quantitative]
        - [@raczka_2018_what]
        - [@pandit_2018_optimizing]
    - Less on structural uncertainty -- i.e. not just what coefficients do we use, but what _equations_, and more generally, what _processes_ do we even consider?
- What are the processes that drive succession of ecological communities?
    - Competition for light [@bazzaz_1979_physiological]
    - Others? Leaning towards omitting because factorial combination becomes too large.
        - Competition for water?
        - Competition for nutrients? (ED's N model isn't very good. Alternatives are being developed, but not in ED mainline yet.)
- Brief review of community/ecosystem ecology of the Upper Midwest
    - UMBS is a useful site for testing these theories because of its natural history.
    - Around 1900, mature forest dominated by white (_Pinus strobus_) and red pine (_Pinus resinosa_), hemlock (_Tsuga canadensis_), and sugar maple (_Acer saccharum_).
    - But, repeat harvest and burning between 1880 and 1920 [@kilburn_1960_effects] led to replacement by early successional aspen (_Populus grandidentata_ and _Populus tremuloides_), birch (_Betula papyrifera_), and cherry (_Prunus pensylvatica_) [@gates_1930_aspen; @barnes_1981_michigan; @friedman_2005_regional_legacies_logging; @bergen_2007_observing].
    - Such aspen-dominated secondary forests are sustained by background levels of disturbance, particularly fire [@gates_1930_aspen]
    - However, due to aggressive fire suppression in the US, these forests are now undergoing succession, primarily to mid/late-successional hardwood (typified by sugar maple and American beech, _Fagus grandifolia_) or upland conifer (typified by red and white pine) [@bergen_2007_observing].
    - The combination of stand-replacing disturbance ~100 years ago and suppressed disturbance since then makes this an ideal site for testing a vegetation model run from bare ground without having to prescribe disturbance.
- Guiding questions:
    - Which of these processes do we need to be able to accurately model what happens ("community succession and C cycle dynamics") to Midwestern forests?
    - What is the cost of considering these processes, in terms of additional parametric uncertainty?
    - What are the relative contributions of parametric uncertainty (data limitation) vs. structural uncertainty (theoretical limitation?)?
- Study overview:
    - ED with factorial combination of submodels related to radiative transfer formulation (two-stream vs. multiple scatter), horizontal competition (finite canopy radius vs. complete shading), and trait plasticity (whether or not SLA and Vcmax vary with light level)
    - Ensemble analysis to look at parameter uncertainty

$$ \lambda = \frac{a_{proj}}{\mu} $$

## Methods

### Site description

- Secondary successional forest -- bigtooth aspen (_Populus grandidentata_), northern red oak (_Quercus rubra_), red maple (_Acer rubrum_), paper birch (_Betula papyrifera_), eastern white pine (_Pinus strobus_)
- Average age -- 95 years (2013)
- NEP in UMBS tower is 1.58 MG C ha^-1^ yr^-1^ (0.80-1.98) (1999-2006), but with landscape variation (REF?)
- Heavily logged in late 1800s and early 1900s, disturbed by fire until 1923 (REF)
- Present day composition typical of upper Great Lakes region
- Previously, the site of the FASET experiment [@gough_2013_sustained; @gough_2008_multi]
- UMBS is 87% upland and 13% wetland [@bergen_2007_observing]. We focus on the upland ecosystem, which has the following characteristics (from @bergen_2007_observing):
    - 20.4% moraine, 37.8% high outwash plain, 31.3% low outwash plain, 5.7% lake-margin terrace, 3.6% ice-contact, 1.2% lowland glacial lake
    - 60.9% aspen-dominated, 16.6% northern hardwood (_Acer saccharum_, _Acer rubrum_, _Fagus grandifolia_, _Tilia americana_ (basswood), _Betula alleghaniensis_ (yellow birch), _Fraxinus americana_ (white ash), _Tsuga canadensis_), 13.3% upland conifer (_Pinus strobus_, _Pinus resinosa_)
    - 1.6% northern red oak (_Quercus rubra_)
    - 60.9% transitioning from aspen to next succession, of which: 55.8% to northern hardwood, 34.7% to upland conifer, 3.8% to northern red oak, 2.6% to northern red oak-red maple, 3.1% to upland conifer-northern hardwood

### PFT definitions

- **Early successional hardwood**
    - _Betula papyrifera_ (white/paper birch)
    - _Populus grandidentata_ (bigtooth aspen)
    - _Populus tremuloides_ (trembling aspen)
- **Mid successional hardwood**
    - _Quercus rubra_ (red oak)
    - _Acer rubrum_ (red maple)
    - _Acer pensylvaticum_ (striped maple)
- **Late successional hardwood**
    - _Acer saccharum_ (sugar maple)
    - _Fagus grandifolia_ (American beech)
- **Pine**
    - _Pinus strobus_ (white pine)
- _Omitted candidates_
    - Early hardwood
        - _Prunus pensylvatica_ (fire cherry)
    - Mid hardwood
        - _Betula alleghaniensis_ (yellow birch)
        - _Tilia americana_ (basswood)
        - _Fraxinus americana_ (white ash)
    - Late hardwood
        - _Ostyra virginiana_ (hop-hornbeam)
    - Pine
        - _Pinus resinosa_ (red pine)

##### pagebreak

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies:

```{r colophon, cache = FALSE}
# which R packages and versions?
devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? You may need to change the path value
# if your Rmd is not in analysis/paper/
git2r::repository("../..")
```

View this project on GitHub in repository [ashiklom/fortebaseline](https://github.com/ashiklom/fortebaseline)
(this manuscript file is in [`analysis/paper/paper.Rmd`](https://github.com/ashiklom/fortebaseline/blob/master/analysis/paper/paper.Rmd))
and in Open Science Framework (OSF) at https://osf.io/dznuf/ .
