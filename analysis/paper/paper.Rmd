---
title: "FoRTE baseline"
author:
  - Alexey N. Shiklomanov
  - Jeff Atkins
  - Ben Bond-Lamberty
  - Christopher M. Gough
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::html_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
bibliography: references.bib
csl: "../templates/ecology.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---

```{r, setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>"
  ## fig.path = "../figures/"
)

## library(fortebaseline) # Or use devtools::load_all('.', quiet = T) if your code is in script files, rather than as functions in the `/R` diretory
n <- 0
mdcap <- function(text) {
  n <<- n + 1
  out <- sprintf("**Figure %d**: %s", n, text)
  if (grepl("gfm", knitr::opts_knit$get("rmarkdown.pandoc.to"), ignore.case = TRUE)) {
    out
  } else {
    invisible(NULL)
  }
}
```

# Outline

- **Introduction**
    - Why we need models?
        - Forests are important, for C sequestration, other ecosystem services
        - Policy decisions related to forests depend on future projections
        - We need models to make future projections
    - What kinds of models are out there?
        - Traditional: "Big leaf" models
            - Needed to be simple to run on old computers
            - Don't need as much data
            - ...but they fail to capture important processes, which matter not only for accurate predictions about C cycle, but also because they are processes we care about (habitat, forestry, tourism, etc.)!
        - Individual-based models
            - Much more detailed, but harder to run, and need much more data.
            - Trade-off between complexity and accuracy.
        - Cohort-based models like ED2 as a middle ground?
    - How much complexity do we need to accurately model ecological succession?
        - Lots of existing work on parameteric uncertainty (e.g. Dietze, Raczka, others).
        - Less on structural uncertainty -- i.e. not just what coefficients do we use, but what _equations_, and more generally, what _processes_ do we even consider?
    - What are the processes that drive succession of ecological communities?
        - Competition for light
        - Competition for nutrients
        - Competition for water?
        - Others?
        - Brief review of community/ecosystem ecology of the Upper Midwest
    - Guiding questions:
        - Which of these processes do we need to be able to accurately model what happens ("community succession and C cycle dynamics") to Midwestern forests?
        - What is the cost of considering these processes, in terms of additional parameteric uncertainty?
        - What are the relative contributions of parameteric uncertainty (data limitation) vs. structural uncertainty (theoretical limitation?)?
    - Study overview:
        - ED with factorial combination of submodels
        - Ensemble analysis to look at parameter uncertainty
- **Methods**
    - Site description
    - ED2 model description
        - Common features
        - Submodel descriptions (in brief; more details in appendices)
            - Two-stream RTM
            - Multiple-scatter RTM
            - Finite canopy radius model
            - Trait plasticity scheme
            - N limitation (?)
    - Data sources
        - TRY data
        - Other data? FIA? Remote sensing?
    - Modeling workflow (PEcAn, etc.)
    - Data analysis
        - Structural vs. parametric uncertainty
        - Comparison against "reality"
- **Results**
    - Summary:
        - LAI time series with uncertainties, faceted by model structure
    - Structural uncertainty details
        - Understory light environment and how it affects species matters
        - The multiple-scatter
            - Fig: RTM comparison (Radiation profile)
            - Fig: Crown model comparison
            - Fig: Trait plasticity?
    - Uncertainty analysis
        - Which parameters contribute the most uncertainty?
        - Structural vs. parameteric uncertainty
- **Discussion**
    - Ecological implications of structural uncertainty
        - Predictions about ecological succession are very sensitive to the understory light environment.
            - Need a good representation of canopy structure (finite canopy radius)
            - How you model canopy radiative transfer matters! Small differences in the model can give significant results.
        - But, trait plasticity can provide an alternative mechanism for success in the understory.
            - Important modeling implication for all the emerging research on intra-specific trait variability.
            - This combination of discrete functional types with plastic traits is closer to reality than purely trait-based ("eco-evolutionary?") models or completely discretized models with static traits on the other.
            - Important caveat: Current implementation is based entirely on tropical data, which has more extreme canopy shading than temperate forests (REF), so tropical species may have evolved stronger trait plasticity than temperate species (REF).
    - Implications of uncertainty analysis for future data collection and model development
        - Parameter uncertainty is still a _huge_ source of overall model predictive uncertainty. Different parameters can give _qualitatively_ different ecological outcomes.
        - Looking beyond aggregate variables (e.g. net primary productivity, total LAI) is essential to model evaluation and calibration. It's possible to generate a relatively?
        - (Expected) Subsurface parameters (e.g. leaf-root ratios) have high sensitivity, but are poorly constrained.
        - Trait covariance may alleviate some data limitation (Shiklomanov et al. 2018 [preprint])
    - Future directions: Predicting disturbance response
        - FoRTE project -- Forecasting a disturbance.
            - Compare ecological resilience/memory between model and reality
    
Journal ideas:

- _Global Change Biology_ -- 8000 word limit may be OK, especially if many methodological details are punted to the appendices.
- _Ecological Monographs_ -- To do this topic justice may require a lot of words and figures. It may be hard to squeeze all of this information into a regular research paper.

# Introduction

Earth's climate is changing, and its terrestrial ecosystems are likely to be affected (REF: IPCC).
Many of these ecosystems will be affected through persistent changes in their environment, for instance through elevated atmospheric CO~2~ concentrations and temperature, changing precipitation regimes (REF).
At the same time, climate change is likely change the frequency and severity of disturbances [@dale_2001_climate], and the impacts of these changes may be more acute.

<!-- Add something positive about each of these? Then, the section about models is more compelling. -->
In trying to anticipate future changes to terrestrial ecosystems, ecologists have four general techniques.
One approach is to look to the past to see how ecosystems responded to similar changes (REFs -- e.g. PALEON?).
This is challenging for two reasons:
For one, we often have to look very far back to find similar climate changes, and the techniques we have for determining the state of ecosystems in the distant past have limited detail (REF).
More importantly, there are few (if any) times where the climate has changed as rapidly as it is now, and it is unclear whether slower changes in the past will trigger responses similar to the faster changes happening now (REF).
A second approach is space-for-time substitution, whereby we use existing climatic gradients through space (e.g. with latitude or elevation) to infer the corresponding changes through time (REF).
However, many processes that drive spatial variation in ecosystems play out over hundreds or thousands of years (e.g. evolution), far longer than policy-relevant timescales of years to decades and far slower than the current pace of climate change (REF).
A third approach is to conduct experimental manipulations, where individuals are subjected to controlled changes in environmental conditions [@medlyn_2015_using].
Because they are able to isolate specific changes by controlling for most other factors, experiments are very useful for testing mechanisms.
Unfortunately, resource constraints limit the spatial and temporal extent of experiments, and emerging evidence from (the relatively few) long-term experiments suggests that short-term results cannot always be extrapolated from longer-term results [@reich_2018_unexpected].

The fourth approach is to use computer models based on existing understanding of ecosystem function.
Models unconstrained by data are little more than thought experiments with limited value to decision-making.
However, models provide a useful tool for confronting hypotheses with observations from a variety of sources, including the three described above [@dietze_2013_improving].

Model design involves an invariable trade-off between complexity and predictive uncertainty.
The more processes are represented in a model (and the more parameters are used to represent those processes), the higher the uncertainty in the "true" value of each parameter, and the higher the uncertainty in model predictions (especially out of sample) (REF -- information theory, e.g. AIC?).
On the other hand, simplistic models often fail to match important properties of the observations.
A key challenge in model development is to find the balance between these two extremes.

Big leaf models (e.g. CLM) fail to capture vegetation dynamics (REF).
This is due to their inability to represent demographic processes, which are important (REF).
An emerging class of models can simulate vegetation demographic processes, including competition for resources within a patch, recruitment, and mortality [@fisher_2017_vegetation].
Individually-based models are one possibility (REFs -- Shugart, Ensheng Wang, etc.).
However, they are complicated (REF).
An alternative are models of intermediate complexity ("middle ground"), which use approximations.
One such approximation is the "Ecosystem Demography" approach, whereby groups of individuals ("cohorts") of similar species, size, and structure are modeled together, and the statistical properties of these cohorts are modeled rather than the characteristics of each individual [@moorcroft_2001_method].

One realization of this is the Ecosystem Demography (v2) model [@moorcroft_2001_method; @medvigy_2011_predicting; @medvigy_2009_mechanistic].
This model has been used to simulate (examples...).
Previous uncertainty analyses with ED:
[@dietze_2014_quantitative]...
More recently, [@raczka_2018_what]...

Light availability is a first order control on photosynthesis, and competition for light is a key process in driving competitive dynamics and community succession.
How light is distributed through a canopy is therefore critically important to accurately simulating community dynamics.
Radiative transfer models are used to simulate light proliferation through a canopy.
Detailed, 3D representations [@widlowski_2014_abstract; @widlowski_2007_third; @malenovsky_2008_influence] have prohibitively high computational costs for use in dynamic vegetation models.
Therefore, these models have had to rely on computationally-efficient approximations.
One common approach is the "two-stream approximation", originally developed for atmospheric radiative transfer [@meador_1980_two] and later adapted for plant canopies [@dickinson_1983_land; @sellers_1985_canopy].
<!-- TODO: Further discussion? -->
Although popular, the two-stream approach has some important limitations (REFS, details...).
An alternative approach is the "multiple scattering" model of @zhao_2005_multiple.
Accounting for multiple scattering enhances canopy light absorption, particularly in near-infrared wavelengths [@zhao_2005_multiple], therefore reducing the amount of light that makes it into the understory (TODO confirm).
<!-- TODO: Further discussion -->

Competition is also strongly determined by canopy structure and how it is represented (REF).
In other words, how much does canopy height matter compared to gappiness and horizontal competition?
C.f. [@hogan_2018_fast; @dietze_2008_changing].

Trait plasticity with light level also plays a role -- i.e. shaded leaves adapt to lower light levels.
C.f. [@keenan_2016_global; @lloyd_2010_optimisation; @niinemets_2016_within].

<!--
TODO: Also discuss the other ED modules.
-->

This manuscript addresses the following research questions:
(Q1) To what extent can the ED2 model reproduce 100 years of observed succession (or observed _anything_) at UMBS starting from bare ground?
(Q2) How does the inclusion of various processes affect the accuracy and predictive uncertainty of ED2 predictions?
(Q3) What drives the predictive uncertainty of the ED2 model at UMBS, and what additional observations are necessary to improve predictions / constrain uncertainty?

Based on previous results [@fisher_2015_taking], we predict ED2 will over-predict dominance of early-successional canopy species (and under-predict understory productivity) under its default configuration.
Enabling dynamic N cycling and a finite canopy radius model will alleviate these issues, but will significantly increase the parameteric uncertainty due to strong sensitivity to N-cycling and canopy gap fraction parameters, respectively.
Constraining these parameters should be a high priority...

# Methods

## Site description

- Secondary successional forest -- bigtooth aspen (_Populus grandidentata_), northern red oak (_Quercus rubra_), red maple (/Acer rubrum/), paper birch (_Betula papyrifera_), eastern white pine (_Pinus strobus_)
- Average age -- 95 years (2013)
- NEP in UMBS tower is 1.58 MG C ha-1 yr-1 (0.80-1.98) (1999-2006), but with landscape variation (REF?)
- Heavily logged in late 1800s and early 1900s, disturbed by fire until 1923
- Present day composition typical of upper Great Lakes region
- Previously, the site of the FASET experiment [@gough_2013_sustained; @gough_2008_multi]

## Model description: ED2

The Ecosystem Demography Model, version 2.X (ED2) [@medvigy_2009_mechanistic].

Summary of common features (can move into supplement if necessary):

- Cohort-based scaling approach
- Photosynthesis / stomatal conductance
    - I think I need to cite @katul_2003_relationship somewhere in here
- Allometries

In this study, we run a factorial experiment of ED2 with the following features enabled or disabled:

- Radiative transfer
  - Two-stream model (ED default)
    - Same general approach as in CLM 4.5 [@clm45_note], but rather than solving for just two layers (sunlit and shaded), solve for each canopy layer.
    - Set up the two-stream equations for each layer as a linear system and solve the entire set of equations numerically
    - Similar to approaches used in other models: JULES [@mercado_2007_improving], ORCHIDEE-CAN [@naudts_2015_vertically], CLM(SPA) [@bonan_2014_modeling]
  - Multiple scatter model
    - Based on @zhao_2005_multiple
- Crown model
  - Infinite (ED2 default)
    - Marginally taller cohorts completely shade out shorter ones
  - Finite
    - Cohorts have a finite crown area, so multiple cohorts have access to the same light level
    - Based on crown area allometries from @dietze_2008_changing
- Trait plasticity
  - None (ED default) -- Trait values are the same at all canopy heights and light levels
  - Plastic
    - V~cmax~(0) decreases with shading, and SLA increases with shading, based on @lloyd_2010_optimisation

## Data sources

TRY data [@kattge_2011_try].

Other data from FoRTE? FIA? Remote sensing?

## Modeling workflow

PEcAn parameter sensitivity and uncertainty analysis [@lebauer_2013_facilitating].
Other PEcAn references: [@dietze_2013_improving].

{TODO: Conceptual diagram of workflow}

# Results

```{r captions}
lai_10yr_cap <- paste(
  "ED2 leaf area index (LAI) predictions by plant functional type."
)

rad_barplot_cap <- paste(
  "Comparison of radiation profiles under two-stream and multiple scatter",
  "canopy radiative transfer models."
)
```

```{r lai_10yr, fig.cap = lai_10yr_cap, fig.dim = c(10, 7)}
readd(results_plot)
```

`r mdcap(lai_10yr_cap)`

Different model configurations produce significantly different ecological trajectories.

## Structural uncertainty

```{r rad_prof, fig.cap = rad_barplot_cap, fig.dim = c(5, 7)}
readd(rad_lineplot)
```

`r mdcap(rad_barplot_cap)`

Compared to the default two-stream model, the multiple scatter model leads to slightly less beam (direct) radiation in the understory but slightly more diffuse radiation.

## Parameter uncertainty

```{r captions_uncertainty}
annual_means_cap <- paste(
  "Total annual gross (GPP) and net (NPP) primary productivity,",
  "and maximum annual leaf area index (LAI)",
  "from ED2 parameter ensemble simulations.",
  "Red lines are mean (solid) and min/max (dashed) values",
  "from Hardiman et al. (2013)."
)

annual_lai_workflows_cap <- paste(
  "Max annual leaf area index predictions by plant functional type",
  "across different parameter combinations."
)
```

{TODO: PEcAn variance decomposition analysis, by configuration.}

```{r annual_means, fig.cap = annual_means_cap, fig.dim = c(5, 7)}
readd(old_ensemble_plot)
```

`r mdcap(annual_means_cap)`

```{r annual_lai_workflows, fig.cap = annual_lai_workflows_cap, fig.dim = c(10, 8)}
readd(old_lai_plot)
```

`r mdcap(annual_lai_workflows_cap)`

Different parameter combinations produce qualitatively different successional outcomes.

# Discussion

## Future directions: Disturbance response modeling

Net ecosystem productivity (NEP) declines immediately after disturbance, but recovers in 10-20 years [@amiro_2010_ecosystem].
Extent of recovery depends on balance of gross (aboveground?) primary productivity (GPP) and respiration; GPP increase during recovery, while respiration may stay constant [@amiro_2010_ecosystem].


# Conclusion

# Acknowledgements

<!-- The following line inserts a page break when the output is MS Word. For page breaks in PDF, use \newpage on its own line.  -->
##### pagebreak

# References 
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

# Appendix 1: Submodel descriptions

## Radiative transfer: Definitions

- $\omega$ -- Clumping factor
- $LAI$ -- Leaf area index
- TAI -- Total area index (leaf and woody area)
- $LAI_e$ / $TAI_e$ -- "Effective" area indices (accounting for clumping)

## Two-stream RTM

<!-- TODO -->

## Multiple scatter RTM

$$ LAI_e = \omega LAI $$

$$ TAI_e = LAI_e + WAI $$

$$ TAI_{l} = \frac{TAI_e}{CAI} $$

Leaf ($w_l$) and wood ($w_w$) weights:

$$ w_l = \frac{LAI_e}{TAI_e} $$
$$ w_w = 1 - w_l $$

Projected area, based on coefficients $\phi_1$ and $\phi_2$.

$$ a_{proj} = \phi_1 + \phi_2 \mu $$

$$ \lambda = \frac{a_{proj}}{\mu} $$


##### pagebreak

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? You may need to change the path value
# if your Rmd is not in analysis/paper/
git2r::repository("../..")
```
