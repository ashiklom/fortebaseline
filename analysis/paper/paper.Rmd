---
title: "FoRTE baseline"
author:
  - Alexey N. Shiklomanov
  - Jeff Atkins
  - Ben Bond-Lamberty
  - Christopher M. Gough
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
    bookdown::html_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
bibliography: references.bib
csl: "../templates/ecology.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights.
---

```{r, setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>"
  ## fig.path = "../figures/"
)

## library(fortebaseline) # Or use devtools::load_all('.', quiet = T) if your code is in script files, rather than as functions in the `/R` diretory
n <- 0
mdcap <- function(text) {
  n <<- n + 1
  out <- sprintf("**Figure %d**: %s", n, text)
  if (grepl("gfm", knitr::opts_knit$get("rmarkdown.pandoc.to"), ignore.case = TRUE)) {
    out
  } else {
    invisible(NULL)
  }
}
```

# Introduction

Temperate forests in the Upper Midwest are important.
{C sequestration}.
{Other ecosystem services}.
However, the fate of these forests is highly uncertain.
The natural ecological succession of these forests has been significantly altered by the interactions of a significantly different and rapidly changing climate, and novel disturbance regimes under which some natural disturbances (e.g. fire) are suppressed while others (e.g. harvest; pests and pathogens) may be becoming more frequent. <!-- TODO refs -->
{UMBS ecological background/natural history?} 
Therefore, predictions about the future of these forests based on past analogs may not be reliable.

Instead, more reliable predictions can be obtained by using dynamic vegetation models that explicitly represent process involved in forest growth and mortality.
Vegetation models fall broadly along the following spectrum of complexity.
On one side are relatively simple "Big leaf" models---such as PNET, SiBCASA, and Biome-BGC <!-- TODO refs; more examples? -->---in which the vegetation at a particular location consists essentially of a single large "plant" whose characteristics are the (weighted) average of all the vegetation at that site. <!-- TODO refs -->
These models were designed originally to simulate the land surface boundary condition for atmospheric general circulation models, though similar models continue to be applied successfully to simulate biogeochemical processes in many ecosystem science contexts. <!-- TODO refs -->
On the other end of the spectrum are "individual-based" models (a.k.a. "gap models"), which explicitly simulate multiple indivduals competing for resources at a single site [@shugart_2015_computer]. <!-- TODO other refs? -->
Examples of such models are LANDIS <!-- TODO ref !--> and UVAFME. <!-- TODO ref --> <!-- TODO Others? -->
Because these models can explicitly represent inter-specific differences in plant productivity, resource allocation, and stress tolerance (among others), as well as the competition that emerges out of these differences, they may be better able to represent changes in ecosystem-scale processes, especially in no-analog conditions [@purves_2008_predictive].
Moreover, these models' predictions of species composition and ecosystem structure are relevant outside of carbon cycle science, particularly for forest management and wildlife conservation. <!-- TODO refs -->
However, these benefits of individual-based models come at the cost of much higher data and computational requirements, which effectively restrict their application to individual, well-studied sites. <!-- TODO refs. Also, is this actually true? -->

A key challenge of vegetation modeling research over the last several decades has been the development of approaches that capture the emergent biogeochemical and ecological outcomes of interactions between individual plants without the need for explicitly simulating each individual [@purves_2008_predictive].
One such approach is the "ecosystem demography" approach, which uses a system of partial differential equations to simulate the emergent mean behavior of "cohorts" of individuals of similar composition, size, and age [@moorcroft_2001_method]. <!-- TODO Run this description by Mike? -->
The original "Ecosystem Demography" (ED) model [@moorcroft_2001_method] was enhanced by @medvigy_2009_mechanistic (as ED2) with fully-coupled leaf physiology, canopy radiative transfer, and micrometeorology, and each of these components have been further refined over the last decade [culminating in ED2.2; @longo_2019_ed1].
Various versions of the ED model have been validated in boreal [@medvigy_2011_predicting], temperate [@medvigy_2009_mechanistic; @dietze_2014_quantitative; @raczka_2018_what], and tropical biomes [@moorcroft_2001_method; @longo_2019_ed2], and have been applied in:
- paleoecological studies [@rollinson_2017_emergent];
- free-air CO~2~ enrichment studies [@dekauwe_2013_forest; @miller_2015_alteration];
- estimation of potential carbon stocks [@hurtt_2004_beyond_potential_vegetation]
- vegetation-climate feedbacks {Swann, etc} <!-- TODO -->

Vegetation model projections are inherently uncertain, and this uncertainty stems from several sources.
_Driver_ uncertainty refers to uncertainty in data about processes that are essential to the system in question but are not represented by the model (e.g. weather and climate for vegetation models).
_Initial condition_ uncertainty arises from the fact that models have to start somewhere, and the exact conditions at the place and time simulations begin are uncertain.
_Process_ or _structural_ uncertainty arises because vegetation models necessarily only represent a subset of all processes involved in plant biology, and that the process that are included can usually be represented in multiple different ways (i.e. which processes are included, and how they are represented).
Finally, _parameter_ uncertainty arises because of natural variability and imperfect calibration of the above process representations.
<!-- TODO This whole paragraph is awkward -->

Several recent studies have looked at parameter uncertainty in ED2.
@dietze_2014_quantitative evaluated which ED2 parameters contributed the most to uncertainties in ED2 simulations of productivity across multiple biomes in North America at 1, 5, and 10 year time scales.
They found that the parameters contributing the most to model uncertainty across all biomes were those related to growth respiration, mortality, stomatal conductance, and water uptake.
However, they also found that despite some common patterns, parameter uncertainty varied with biome.
More recently, a similar analysis evaluated parameter uncertainty over 100 year time scale at the Willow Creek Ameriflux site, and found that the most important parameters to model uncertainty were quantum efficiency of photosynthesis, leaf respiration, and soil-plant water transfer [@raczka_2018_what].
Another recent study assessed parameter uncertainty in ED2 as part of its overall goal of parameterizing the model for sagebrush [@pandit_2018_optimizing].
They found that the most important parameters were specific leaf area, the maximum rate of carbon fixation (V~cmax~), slope of stomatal conductance, the fine-root to leaf carbon ratio, and the fine root turnover rate.
Another study looked specifically at contributions to uncertainty from parameters related to canopy radiative transfer, and found that parameters related to both canopy structure and leaf optical properties had a large (>20%) impact on predictions of net primary productivity [@viskari_2019_influence].
The variability in results across these studies demonstrates that parameter contributions to ED2 uncertainty are highly variable, and that additional parameter uncertainty studies are needed.

While parameter uncertainty ED2 has been previously evaluated, less work has been done on structural uncertainty.
Numerous vegetation model intercomparison studies have demonstrated that different models produce significantly different projections of overall land carbon sequestration [@friedlingstein_2006_climate; @friedlingstein_2014_uncertainties], response to CO~2~ fertilization (REF - Medlyn?), high-latitude warming (Rogers and Serbin?), {others...}. <!-- TODO -->
These differences have been attributed to differences in model representations of key processes, including canopy radiative transfer [@fisher_2017_vegetation] and photosynthesis [@rogers_2016_roadmap]. <!-- TODO More here? -->
However, the extent to which specific processes contribute to model uncertainty is difficult to evaluate from model intercomparisons because different models are different from each other in too many different ways.
In this study, we evaluate structural uncertainty more precisely/directly by selectively toggling and switching individual processes/model components in ED2 while keeping everything else constant.

The focus of this study is on the interaction between parametric and structural uncertainty in the ED2 model.
Driver uncertainty is outside the scope of this study, and initial condition uncertainty is minimized by our experimental design, which is conditioned on a specific initial condition (near bare ground).
Our study is organized around the following guiding questions:
(1) Which processes related to light utilization are most important to accurately modeling community succession and C cycle dynamics in temperate forests of the Upper Midwest?
(2) What is the cost of considering these processes, in terms of additional parameteric uncertainty?
(3) What are the relative contributions of parameteric uncertainty (data limitation) vs. structural uncertainty (theoretical limitation?)?
To answer these questions, we ran ED2 ensemble simulationes with a factorial combination of submodels related to radiative transfer formulation (two-stream vs. multiple scatter), horizontal competition (finite canopy radius vs. complete shading), and trait plasticity (whether or not SLA and Vcmax vary with light level)
We then used a sensitivity and variance decomposition analysis to evaluate the contribution of parameter uncertainty for each model configuration.

## Old introduction outline

- Why we need models?
    - Forests are important, for C sequestration, other ecosystem services
    - Policy decisions related to forests depend on future projections
    - We need models to make future projections
- What kinds of models are out there?
    - Traditional: "Big leaf" models
        - Needed to be simple to run on old computers
        - Don't need as much data
        - ...but they fail to capture important processes, which matter not only for accurate predictions about C cycle, but also because they are processes we care about (habitat, forestry, tourism, etc.)!
    - Individual-based models
        - Much more detailed, but harder to run, and need much more data.
        - Trade-off between complexity and accuracy.
- Cohort-based models like ED2 as a middle ground?
    - Core ED concept [@moorcroft_2001_method]
    - ED2 developments -- [@medvigy_2009_mechanistic; @medvigy_2011_predicting]
    - Most recent version -- [@longo_2019_ed1]
    - Validation/applications of the ED model:
        - [@rollinson_2017_emergent] -- ED2 paleoclimate
        - [@miller_2015_alteration] -- ED2 at Duke FACE
        - [@dekauwe_2013_forest] -- ED2 at Duke and Oak Ridge FACE
        - [@longo_2019_ed2] -- Model evaluation in Tropics
- How much complexity do we need to accurately model ecological dynamics?
    - Lots of existing work on parameteric uncertainty
        - [@dietze_2014_quantitative]
        - [@raczka_2018_what]
        - [@pandit_2018_optimizing]
    - Less on structural uncertainty -- i.e. not just what coefficients do we use, but what _equations_, and more generally, what _processes_ do we even consider?
- What are the processes that drive succession of ecological communities?
    - Competition for light [@bazzaz_1979_physiological]
    - Others? Leaning towards omitting because factorial combination becomes too large.
        - Competition for water?
        - Competition for nutrients? (ED's N model isn't very good. Alternatives are being developed, but not in ED mainline yet.)
- Brief review of community/ecosystem ecology of the Upper Midwest
    - UMBS is a useful site for testing these theories because of its natural history.
    - Around 1900, mature forest dominated by white (_Pinus strobus_) and red pine (_Pinus resinosa_), hemlock (_Tsuga canadensis_), and sugar maple (_Acer saccharum_).
    - But, repeat harvest and burning between 1880 and 1920 [@kilburn_1960_effects] led to replacement by early successional aspen (_Populus grandidentata_ and _Populus tremuloides_), birch (_Betula papyrifera_), and cherry (_Prunus pensylvatica_) [@gates_1930_aspen; @barnes_1981_michigan; @friedman_2005_regional_legacies_logging; @bergen_2007_observing].
    - Such aspen-dominated secondary forests are sustained by background levels of disturbance, particularly fire [@gates_1930_aspen]
    - However, due to aggressive fire suppression in the US, these forests are now undergoing succession, primarily to mid/late-successional hardwood (typified by sugar maple and American beech, _Fagus grandifolia_) or upland conifer (typified by red and white pine) [@bergen_2007_observing].
    - The combination of stand-replacing disturbance ~100 years ago and suppressed disturbance since then makes this an ideal site for testing a vegetation model run from bare ground without having to prescribe disturbance.
- Guiding questions:
    - Which of these processes do we need to be able to accurately model what happens ("community succession and C cycle dynamics") to Midwestern forests?
    - What is the cost of considering these processes, in terms of additional parameteric uncertainty?
    - What are the relative contributions of parameteric uncertainty (data limitation) vs. structural uncertainty (theoretical limitation?)?
- Study overview:
    - ED with factorial combination of submodels related to radiative transfer formulation (two-stream vs. multiple scatter), horizontal competition (finite canopy radius vs. complete shading), and trait plasticity (whether or not SLA and Vcmax vary with light level)
    - Ensemble analysis to look at parameter uncertainty

# Methods

## Site description

- Secondary successional forest -- bigtooth aspen (_Populus grandidentata_), northern red oak (_Quercus rubra_), red maple (_Acer rubrum_), paper birch (_Betula papyrifera_), eastern white pine (_Pinus strobus_)
- Average age -- 95 years (2013)
- NEP in UMBS tower is 1.58 MG C ha^-1^ yr^-1^ (0.80-1.98) (1999-2006), but with landscape variation (REF?)
- Heavily logged in late 1800s and early 1900s, disturbed by fire until 1923 (REF)
- Present day composition typical of upper Great Lakes region
- Previously, the site of the FASET experiment [@gough_2013_sustained; @gough_2008_multi]
- UMBS is 87% upland and 13% wetland [@bergen_2007_observing]. We focus on the upland ecosystem, which has the following characteristics (from @bergen_2007_observing):
    - 20.4% moraine, 37.8% high outwash plain, 31.3% low outwash plain, 5.7% lake-margin terrace, 3.6% ice-contact, 1.2% lowland glacial lake
    - 60.9% aspen-dominated, 16.6% northern hardwood (_Acer saccharum_, _Acer rubrum_, _Fagus grandifolia_, _Tilia americana_ (basswood), _Betula alleghaniensis_ (yellow birch), _Fraxinus americana_ (white ash), _Tsuga canadensis_), 13.3% upland conifer (_Pinus strobus_, _Pinus resinosa_)
    - 1.6% northern red oak (_Quercus rubra_)
    - 60.9% transitioning from aspen to next succession, of which: 55.8% to northern hardwood, 34.7% to upland conifer, 3.8% to northern red oak, 2.6% to northern red oak-red maple, 3.1% to upland conifer-northern hardwood

## ED2 model description

The Ecosystem Demography Model, version 2.2 (ED2).
Default configuration is described in [@longo_2019_ed1].

In this study, we run a factorial experiment of ED2 with the following features enabled or disabled:

- Radiative transfer
  - Two-stream model (ED default)
    - Same general approach as in CLM 4.5 [@clm45_note], but rather than solving for just two layers (sunlit and shaded), solve for each canopy layer.
    - Set up the two-stream equations for each layer as a linear system and solve the entire set of equations numerically
    - Similar to approaches used in other models: JULES [@mercado_2007_improving], ORCHIDEE-CAN [@naudts_2015_vertically], CLM(SPA) [@bonan_2014_modeling]
    - For details, see Supplements S9 and S10 in [@longo_2019_ed1].
  - Multiple scatter model
    - Based on @zhao_2005_multiple
- Crown model
  - Infinite (ED2 default)
    - Marginally taller cohorts completely shade out shorter ones
  - Finite
    - Cohorts have a finite crown area, so multiple cohorts have access to the same light level
    - Based on crown area allometries from @dietze_2008_changing
- Trait plasticity
  - None (ED default) -- Trait values are the same at all canopy heights and light levels
  - Plastic
    - V~cmax~(0) decreases with shading, and SLA increases with shading, based on @lloyd_2010_optimisation
    - V~cmax~(0) decline with shade tolerance is supported by classic ecological theory on succession [@bazzaz_1979_physiological]

## Data sources

BETYdb [@lebauer_2013_facilitating].

TRY data [@kattge_2011_try].

CRUNCEP met.

Other FoRTE data?
- LAI trends: 1997-2014
- Aboveground NPP data: 1999-2017

## Modeling workflow

PEcAn parameter sensitivity and uncertainty analysis [@lebauer_2013_facilitating].
Other PEcAn references: [@dietze_2013_improving].

Plant functional type definitions:

- **Early successional hardwood**
    - _Betula papyrifera_ (white/paper birch)
    - _Populus grandidentata_ (bigtooth aspen)
    - _Populus tremuloides_ (trembling aspen)
- **Mid successional hardwood**
    - _Quercus rubra_ (red oak)
    - _Acer rubrum_ (red maple)
    - _Acer pensylvaticum_ (striped maple)
- **Late successional hardwood**
    - _Acer saccharum_ (sugar maple)
    - _Fagus grandifolia_ (American beech)
- **Pine**
    - _Pinus strobus_ (white pine)
- _Omitted candidates_
    - Early hardwood
        - _Prunus pensylvatica_ (fire cherry)
    - Mid hardwood
        - _Betula alleghaniensis_ (yellow birch)
        - _Tilia americana_ (basswood)
        - _Fraxinus americana_ (white ash)
    - Late hardwood
        - _Ostyra virginiana_ (hop-hornbeam)
    - Pine
        - _Pinus resinosa_ (red pine)
    
```{r param-table}
tbl <- readd(param_table)
tbl <- subset(tbl, select = -unit_parsed)
tbl[["ED Name"]] <- sprintf("`%s`", tbl[["ED Name"]])
knitr::kable(tbl, escape = FALSE, caption = paste0(
  "**Table**: Parameter descriptions. ",
  "For additional information, see the ",
  "[ED2 model wiki](https://github.com/EDmodel/ED2/wiki/PFT-parameters)."
))
```

```{r methods_captions}
param_dist_cap <- paste(
  "Input parameter distributions from PEcAn trait meta-analysis."
)
```

```{r param_dist, fig.cap = param_dist_cap, fig.dim = c(13, 10)}
readd(param_dist_gg)
```

`r mdcap(param_dist_cap)`

For each combination of ED submodels, we ran 10 ED ensemble simulations.

## Analysis of results

- Structural vs. parameteric uncertainty
- Comparison against observations
- Others...

# Results

## Summary

```{r summary-ts-plot, fig.cap = summary_ts_cap, fig.dim = c(10, 7)}
summary_ts_cap <- paste(
  "ED2 plot-level ensemble predictions of",
  "gross (GPP) and net (NPP) primary productivity,",
  "total leaf area index (LAI), and aboveground biomass (AGB)",
  "by model configuration.",
  "Red lines are mean (dashed) and min/max (dotted) values",
  "from Hardiman et al. (2013)."
)
readd(summary_ts_plot)
```

`r mdcap(summary_ts_cap)`

Take-away: Parameter uncertainty is as large as, or even larger, than structural uncertainty.

```{r bigfacet-plot, fig.cap = bigfacet_cap, fig.dim = c(12, 12)}
bigfacet_cap <- paste(
  "ED2 PFT-level predictions of leaf area index (LAI) by model configuration and parameterization."
)
readd(bigfacet_plot)
```

`r mdcap(bigfacet_cap)`

Take-away: Different parameter combinations produce not just quantitatively different bulk ecosystem properties (e.g. NPP, total LAI), but also qualitatively different successional/ecological outcomes.

## Uncertainty analysis

```{r within-vs-across, fig.cap = within_vs_across_cap, fig.dim = c(6, 6)}
within_vs_across_cap <- paste(
  "Comparison of parameteric uncertainty within ensembles (colored bars, colored by model type)",
  "and \"structural\" uncertainty (variance in ensemble means; black bar) by output variable.",
  "Output variables are expressed as growing season averages for all years after 1910."
)
readd(within_across_plot)
```

`r mdcap(within_vs_across_cap)`

Take-away: Overall, structural uncertainty (variance in ensemble means across structures) is comparable or lower than parameter uncertainty (uncertainty within ensembles for a given structure).
Parameter uncertainty varies significantly across model structures.
Enabling trait plasticity increases variance in predictions of AGB.
Enabling the finite canopy radius increases the variance in LAI predictions.
GPP and NPP have the highest variance by far for the combination of finite canopy radius and two-stream radiative transfer.

```{r uncertainty-analysis, fig.cap = uncertainty_analysis_cap, fig.dim = c(15, 15)}
uncertainty_analysis_cap <- paste(
  "PEcAn-liked parameter sensitivity and uncertainty analysis, by model type.",
  "Elasticity (a) is the normalized sensitivity of the model to a fixed change in the parameter.",
  "pvar (b) is the partial variance, which describes the overall contribution of the parameter to model predictive uncertainty based on the combination of parameter uncertainty and model sensitivity.",
  "Input parameter distributions are shown in Figure XXX."
)
readd(sensitivity_plot)
```

`r mdcap(uncertainty_analysis_cap)`

Take-away: Model parameter uncertainty is sensitive to model configuration.
For example, turning on the finite canopy radius with the two-stream canopy RTM increases sensitivity across many parameters.

## Details about model structures

```{r rad_prof, fig.cap = rad_barplot_cap, fig.dim = c(5, 7)}
rad_barplot_cap <- paste(
  "Comparison of radiation profiles under two-stream and multiple scatter",
  "canopy radiative transfer models."
)
```

`r mdcap(rad_barplot_cap)`

<!-- Compared to the default two-stream model, the multiple scatter model leads to slightly less beam (direct) radiation in the understory but slightly more diffuse radiation. -->

(TODO)


# Discussion

- Comparisons against other studies
    - Parameter sensitivity
        - [@pandit_2018_optimizing] -- Most important parameters for shrubs were SLA, Vcmax, stomatal slope, root:leaf ratio, and root turonver rate (slightly less important: leaf turnover rate, growth respiration, cuticular conductance; much less important: water conductance; basically irrelevant: storage turnover, leaf width)
- Ecological implications of structural uncertainty
    - Predictions about ecological succession are very sensitive to the understory light environment.
        - Need a good representation of canopy structure (finite canopy radius)
        - How you model canopy radiative transfer matters! Small differences in the model can give significant results.
    - But, trait plasticity can provide an alternative mechanism for success in the understory.
        - Important modeling implication for all the emerging research on intra-specific trait variability.
        - This combination of discrete functional types with plastic traits is closer to reality than purely trait-based ("eco-evolutionary?") models or completely discretized models with static traits on the other.
        - Important caveat: Current implementation is based entirely on tropical data, which has more extreme canopy shading than temperate forests (REF), so tropical species may have evolved stronger trait plasticity than temperate species (REF).
- Implications of uncertainty analysis for future data collection and model development
    - Parameter uncertainty is still a _huge_ source of overall model predictive uncertainty. Different parameters can give _qualitatively_ different ecological outcomes.
    - Looking beyond aggregate variables (e.g. net primary productivity, total LAI) is essential to model evaluation and calibration. It's possible to generate a relatively?
    - (Expected) Subsurface parameters (e.g. leaf-root ratios) have high sensitivity, but are poorly constrained.
    - Trait covariance may alleviate some data limitation (Shiklomanov et al. 2018 [preprint])
- Future directions: Predicting disturbance response
    - FoRTE project -- Forecasting a disturbance.
        - Compare ecological resilience/memory between model and reality

# Conclusions

<!-- TODO -->

# Acknowledgements

This project funded by NSF grant.
Cyberinfrastructure provided by Pacific Northwest National Laboratory (PNNL).
Data from University of Michigan Biological Station (UMBS).
Data from TRY (TODO: Specific TRY statement).

<!-- The following line inserts a page break when the output is MS Word. For page breaks in PDF, use \newpage on its own line.  -->
##### pagebreak

# References
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

# Appendix 1: Submodel descriptions

## Radiative transfer: Definitions

- $\omega$ -- Clumping factor
- $LAI$ -- Leaf area index
- TAI -- Total area index (leaf and woody area)
- $LAI_e$ / $TAI_e$ -- "Effective" area indices (accounting for clumping)

## Two-stream RTM

<!-- TODO -->

## Multiple scatter RTM

$$ LAI_e = \omega LAI $$

$$ TAI_e = LAI_e + WAI $$

$$ TAI_{l} = \frac{TAI_e}{CAI} $$

Leaf ($w_l$) and wood ($w_w$) weights:

$$ w_l = \frac{LAI_e}{TAI_e} $$
$$ w_w = 1 - w_l $$

Projected area, based on coefficients $\phi_1$ and $\phi_2$.

$$ a_{proj} = \phi_1 + \phi_2 \mu $$

$$ \lambda = \frac{a_{proj}}{\mu} $$


##### pagebreak

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies:

```{r colophon, cache = FALSE}
# which R packages and versions?
devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? You may need to change the path value
# if your Rmd is not in analysis/paper/
git2r::repository("../..")
```
